function debounce(e,t){let o;return function(...s){clearTimeout(o),o=setTimeout(()=>e.apply(this,s),t)}}console.log("Kyu nahi ho rahi padhai?");const firebaseConfig={apiKey:"AIzaSyAO9ya8gHtVbMfxcnAAJrz6FdYWvIRqgBY",authDomain:"studydashboard-2a3eb.firebaseapp.com",projectId:"studydashboard-2a3eb",storageBucket:"studydashboard-2a3eb.firebasestorage.app",messagingSenderId:"79210973277",appId:"1:79210973277:web:cc0a5fa86729fd6d3f65b4",measurementId:"G-TE7Z0SR8L1"};firebase.initializeApp(firebaseConfig);const auth=firebase.auth(),db=firebase.firestore();let currentUser=null,syncTimeout=null,unsubscribeFirestore=null;document.addEventListener("DOMContentLoaded",()=>{let e={tests:"jeePartTests_v2",layout:"jeeDashboardLayout_v3",customCards:"jeeCustomCards_v3",settings:"jeeDashboardSettings_v3",mobileAlertDismissed:"jeeMobileAlertDismissed_v1",cardProps:"jeeCardProps_v2",pomodoroState:"jeePomodoroState_v1",timeLoggerState:"jeeTimeLoggerState_v1",studyLogs:"jeeStudyLogs_v1"},t={JEE:{January:{2026:"2026-01-21",2027:"2027-01-21",2028:"2028-01-21"},April:{2026:"2026-04-05",2027:"2027-04-05",2028:"2028-04-05"}},NEET:{2026:"2026-05-03",2027:"2027-05-02",2028:"2028-05-07"}},o=JSON.parse(localStorage.getItem(e.settings)),s={tests:JSON.parse(localStorage.getItem(e.tests))||{},customCards:JSON.parse(localStorage.getItem(e.customCards))||[{id:"default-todo",type:"todo",title:"My Tasks",content:[]},{id:"default-line-graph",type:"line-graph",title:"Mock Test Progress",content:[{name:"Test 1",marks:120,subjects:{chemistry:40,physics:60,maths:20},maxMarks:300},{name:"Test 2",marks:145,subjects:{chemistry:50,physics:70,maths:25},maxMarks:300},{name:"Test 3",marks:160,subjects:{chemistry:50,physics:80,maths:30},maxMarks:300},]},{id:"default-note",type:"note",title:"Welcome!",content:"Welcome to your new dashboard! You can drag, resize, and delete these cards. Add your own from the top right customise button. Best of luck in your journey! You can delete this card now."},{id:"default-study-logger",type:"time-logger",title:"Study Log",content:[]},],layout:JSON.parse(localStorage.getItem(e.layout))||["countdown","graph","default-todo","default-study-logger","default-note","default-line-graph","tests","quote","time",],settings:{theme:"default",font:"'Inter', sans-serif",bgUrl:"",examType:"JEE",examYear:"2026",jeeSession:"April",jeeShiftDate:"",youtubeTintEnabled:!0,youtubeBlurEnabled:!1,focusShieldEnabled:!1,ricedModeEnabled:!1,tickingSoundEnabled:!1,userSubjects:[],customExamName:"",customExamDate:"",streamlinedModeEnabled:!1,...o},cardProps:JSON.parse(localStorage.getItem(e.cardProps))||{graph:{colspan:2},"default-line-graph":{colspan:1},"default-study-logger":{colspan:1}},pomodoroState:JSON.parse(localStorage.getItem(e.pomodoroState))||{},timeLoggerState:JSON.parse(localStorage.getItem(e.timeLoggerState))||{},studyLogs:JSON.parse(localStorage.getItem(e.studyLogs))||{},chartInstances:{},activeTimer:{cardId:null,type:null,unfocusedTime:0,unfocusedStart:0},save(t){localStorage.setItem(e[t],JSON.stringify(this[t])),currentUser&&(b("Saving..."),h())},saveSettings(){localStorage.setItem(e.settings,JSON.stringify(this.settings)),currentUser&&(b("Saving..."),h())}},a=[{text:"The secret of getting ahead is getting started.",author:"Mark Twain"},{text:"Itâ€™s not whether you get knocked down, itâ€™s whether you get up.",author:"Vince Lombardi"},{text:"Success is the sum of small efforts, repeated day in and day out.",author:"Robert Collier"},{text:"The expert in anything was once a beginner.",author:"Helen Hayes"},{text:"Believe you can and you're halfway there.",author:"Theodore Roosevelt"},{text:"The difference between ordinary and extraordinary is that little extra.",author:"Jimmy Johnson"},{text:"A person who never made a mistake never tried anything new.",author:"Albert Einstein"},{text:"The harder I work, the luckier I get.",author:"Samuel Goldwyn"},{text:"Success is not final, failure is not fatal: it is the courage to continue that counts.",author:"Winston Churchill"},{text:"Strive for progress, not perfection.",author:"Unknown"},{text:"Genius is one percent inspiration and ninety-nine percent perspiration.",author:"Thomas A. Edison"},{text:"It does not matter how slowly you go as long as you do not stop.",author:"Confucius"},{text:"Doubt kills more dreams than failure ever will.",author:"Suzy Kassem"},{text:"Push yourself, because no one else is going to do it for you.",author:"Unknown"},{text:"If you want to shine like a sun, first burn like a sun.",author:"A. P. J. Abdul Kalam"},{text:"The important thing is not to stop questioning. Curiosity has its own reason for existing.",author:"Albert Einstein"},{text:"We are what we repeatedly do. Excellence, then, is not an act, but a habit.",author:"Aristotle"},{text:"The chapters you study today will decide the chapters of your life tomorrow.",author:"Unknown"},{text:"Your toughest competition is the person you were yesterday.",author:"Unknown"},{text:"Rank is just a number. Knowledge and skill are the real assets.",author:"Unknown"},{text:"Dream is not that which you see while sleeping it is something that does not let you sleep.",author:"A. P. J. Abdul Kalam"},{text:"Focus on the process, not the outcome. The right process will lead to the right outcome.",author:"Unknown"},],r=[{text:"Kyu nahi ho rahi padhai?",author:"Alakh Pandey"},{text:"System phaad denge!",author:"A wise man"},{text:"Physics is not a subject, it's an emotion.",author:"Alakh Pandey"},{text:"Aag laga denge!",author:"Revolutionaries"},{text:"Mehnat karta hu bhai",author:"Basava Reddy"},],n=[{text:"Chaitanya is a noob \uD83E\uDD13",author:"Everyone"},{text:"I love Organic Chemistry \uD83E\uDD13",author:"Chaitanya (probably)"},{text:"Isomerism is my favorite topic \uD83E\uDD13",author:"Definitely Chaitanya"},{text:"Just like us guys \uD83E\uDD13",author:"Chaitanya the moron"},],i={body:document.body,mainTitle:document.getElementById("main-title"),mainTitleRiced:document.getElementById("main-title-riced"),dashboardGrid:document.getElementById("dashboard-grid"),authContainer:document.getElementById("auth-container"),authContainerRiced:document.getElementById("auth-container-riced"),syncStatusToast:document.getElementById("sync-status-toast"),modals:{addCard:document.getElementById("add-card-modal"),customize:document.getElementById("customize-modal"),info:document.getElementById("info-modal"),confirm:document.getElementById("confirm-modal")},buttons:{addCard:document.querySelectorAll(".add-card-btn"),cancelAddCard:document.getElementById("cancel-add-card"),customize:document.querySelectorAll(".customize-btn"),closeCustomize:document.getElementById("close-customize"),closeCustomizeIcon:document.getElementById("close-customize-icon-btn"),removeBg:document.getElementById("remove-bg-btn"),closeAlert:document.getElementById("close-alert-btn"),resetDashboard:document.getElementById("reset-dashboard-btn"),info:document.querySelectorAll(".info-btn"),closeInfo:document.getElementById("close-info-modal"),exportData:document.getElementById("export-data-btn"),importData:document.getElementById("import-data-btn"),confirmOk:document.getElementById("confirm-ok-btn"),confirmCancel:document.getElementById("confirm-cancel-btn"),zenModeBtn:document.querySelectorAll(".zen-mode-btn"),exitZenBtn:document.getElementById("exit-zen-btn"),godModeClose:document.getElementById("god-mode-close-btn"),addminutesformOpen:document.getElementById("toggle-manual-form")},forms:{newCard:document.getElementById("new-card-form")},inputs:{cardType:document.getElementById("new-card-type"),cardContent:document.getElementById("new-card-content"),theme:document.getElementById("theme-select"),font:document.getElementById("font-select"),bgUrl:document.getElementById("bg-image-url"),examType:document.getElementById("exam-type-select"),examYear:document.getElementById("exam-year-select"),importFile:document.getElementById("import-file-input"),youtubeTintToggle:document.getElementById("youtube-tint-toggle"),youtubeBlurToggle:document.getElementById("youtube-blur-toggle"),focusShieldToggle:document.getElementById("focus-shield-toggle"),ricedModeToggle:document.getElementById("riced-mode-toggle"),jeeSession:document.getElementById("jee-session-select"),jeeShift:document.getElementById("jee-shift-input"),jeeContainer:document.getElementById("jee-details-container"),customContainer:document.getElementById("custom-exam-container"),customName:document.getElementById("custom-exam-name"),customDate:document.getElementById("custom-exam-date"),tickingSoundToggle:document.getElementById("ticking-sound-toggle"),streamlinedModeToggle:document.getElementById("streamlined-mode-toggle")},mobileAlert:document.getElementById("mobile-alert"),confirmTitle:document.getElementById("confirm-title"),confirmMessage:document.getElementById("confirm-message"),godModePanel:document.getElementById("god-mode-panel")};i.buttons.addCard.forEach(e=>e.disabled=!0),i.dashboardGrid.style.pointerEvents="none",i.dashboardGrid.style.opacity="0.5";let l=null,d=null,c=null;auth.onAuthStateChanged(e=>{e?(currentUser=e,$(e),g()):(currentUser=null,p(),g())});let u=()=>{let e=new firebase.auth.GoogleAuthProvider;auth.signInWithPopup(e).catch(e=>{console.error("Authentication Error:",e)})},m=()=>{unsubscribeFirestore&&(unsubscribeFirestore(),unsubscribeFirestore=null),i.dashboardGrid.innerHTML="",sessionStorage.removeItem("cloud_data_loaded"),auth.signOut()},g=()=>{i.buttons.addCard.forEach(e=>e.disabled=!1),i.dashboardGrid.style.pointerEvents="auto",i.dashboardGrid.style.opacity="1"},p=()=>{let e=[i.authContainer,i.authContainerRiced];e.forEach(e=>{if(e){if(currentUser){let t=`
                    <div class="relative group" id="user-menu-container">
                        <button id="user-menu-button" title="User Menu" class="flex items-center justify-center rounded-full transition-transform active:scale-95 focus:outline-none">
                            <img src="${currentUser.photoURL}" alt="User" class="w-8 h-8 rounded-full object-cover border border-transparent group-hover:border-[var(--border-color)] opacity-90 group-hover:opacity-100 transition-all" />
                        </button>

                        <div id="user-menu-dropdown" class="absolute right-0 mt-2 w-56 origin-top-right transform transition-all duration-200 scale-95 opacity-0 invisible z-50">
                            <div class="card p-0 overflow-hidden shadow-xl ring-1 ring-black/5 backdrop-blur-xl">
                                
                                <div class="px-4 py-3 border-b border-[var(--border-color)] bg-white/5">
                                    <p class="text-sm font-semibold text-[var(--text-primary)] truncate">${currentUser.displayName}</p>
                                    <p class="text-xs text-[var(--text-secondary)] truncate font-mono opacity-75">${currentUser.email}</p>
                                </div>

                                <div class="p-1">
                                    <button id="sign-out-btn" class="w-full text-left flex items-center gap-2 px-3 py-2 text-xs font-medium text-[var(--text-secondary)] rounded hover:bg-white/10 hover:text-red-400 transition-colors">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                                        <span>Sign Out</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;e.innerHTML=t;let o=e.querySelector("#user-menu-button"),s=e.querySelector("#user-menu-dropdown"),a=e.querySelector("#sign-out-btn"),r=e=>{e.stopPropagation();let t=s.classList.contains("invisible");if(t){s.classList.remove("invisible","opacity-0","scale-95"),s.classList.add("opacity-100","scale-100");let o=s.getBoundingClientRect(),a=window.innerWidth;if(o.right>a){let r=o.right-a+10;s.style.right=`${r}px`}else s.style.right="0px"}else s.classList.add("invisible","opacity-0","scale-95"),s.classList.remove("opacity-100","scale-100"),s.style.right=""};o.addEventListener("click",r),a.addEventListener("click",m),document.addEventListener("click",t=>{e.contains(t.target)||(s.classList.add("invisible","opacity-0","scale-95"),s.classList.remove("opacity-100","scale-100"))})}else{let n=`
                    <button id="sign-in-btn" class="flex items-center gap-2 px-3 py-1.5 rounded-md border border-[var(--border-color)] bg-transparent hover:bg-white/5 text-[var(--text-primary)] transition-all text-xs font-medium">
                        <svg class="w-4 h-4" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M47.532 24.552c0-1.566-.14-3.084-.404-4.548H24.5v8.58h12.944c-.566 2.76-2.213 5.108-4.72 6.708v5.524h7.112c4.162-3.832 6.596-9.42 6.596-16.264z" fill="#4285F4"/><path d="M24.5 48c6.48 0 11.944-2.14 15.928-5.788l-7.112-5.524c-2.14 1.44-4.884 2.292-7.816 2.292-6.004 0-11.084-4.04-12.9-9.492H4.42v5.7c3.48 6.912 10.32 11.532 18.08 11.532l2 .28z" fill="#34A853"/><path d="M11.6 28.98c-.34-.996-.54-2.052-.54-3.144s.2-2.148.54-3.144V16.992H4.42C2.852 20.04 2 23.436 2 27.024c0 3.588.852 6.984 2.42 10.032l7.18-5.7v-.376z" fill="#FBBC05"/><path d="M24.5 9.8c3.516 0 6.66 1.212 9.128 3.54l6.32-6.32C36.44.88 30.98 0 24.5 0 16.74 0 9.9 4.62 6.42 11.532l7.18 5.7c1.816-5.452 6.896-9.432 12.9-9.432z" fill="#EA4335"/></svg>
                        <span class="opacity-90">Sign In</span>
                    </button>
                `;e.innerHTML=n,e.querySelector("#sign-in-btn").addEventListener("click",u)}}})},h=debounce(()=>{if(!currentUser)return;console.log("Debounced save triggered. Saving all data to cloud...");let t=db.collection("users").doc(currentUser.uid),o={};for(let s in e){let a=localStorage.getItem(e[s]);a&&(o[s]=JSON.parse(a))}t.set(o).then(()=>{console.log("Debounced save successful.")}).catch(e=>{b("Sync Error"),console.error("Firestore save error:",e)})},2e3),y=async t=>{let o={};for(let s in e){let a=e[s],r=localStorage.getItem(a);if(r)try{o[s]=JSON.parse(r)}catch(n){console.warn(`Failed to parse ${s} during migration.`)}}try{await t.set(o),console.log("Local data successfully migrated to cloud."),b("Data Migrated")}catch(i){console.error("Error migrating data to cloud:",i),b("Migration Failed")}},$=async t=>{p();let o=db.collection("users").doc(t.uid),a=await o.get();a.exists||(console.log("New user detected. Migrating local data to cloud..."),await y(o)),unsubscribeFirestore&&unsubscribeFirestore(),unsubscribeFirestore=o.onSnapshot(t=>{console.log("Received cloud data snapshot...");let o=t.data();if(o){let a=!1;for(let r in e)if(o[r]){let n=JSON.stringify(s[r]),i=JSON.stringify(o[r]);n!==i&&(s[r]=o[r],localStorage.setItem(e[r],i),a=!0)}a&&(console.log("Cloud data merged. Re-rendering dashboard..."),M(),q())}let l=t.metadata.hasPendingWrites?"Syncing...":"All changes saved";b(l)},e=>{console.error("Firestore snapshot error: ",e),b("Sync Error")})},b=e=>{let t=i.syncStatusToast;t.textContent=e,t.classList.add("show"),"Saving..."!==e&&"Syncing..."!==e&&(clearTimeout(syncTimeout),syncTimeout=setTimeout(()=>{t.classList.remove("show")},2e3))},f=null,v=null;function x(e,t,o="Are you sure?",s=null,a="Confirm",r="Cancel"){i.confirmTitle.textContent=o,i.confirmMessage.textContent=e,i.buttons.confirmOk.textContent=a,i.buttons.confirmCancel.textContent=r,f=t,v=s,i.modals.confirm.classList.remove("hidden")}function x(e,t,o="Are you sure?"){i.confirmTitle.textContent=o,i.confirmMessage.textContent=e,f=t,i.modals.confirm.classList.remove("hidden")}i.buttons.confirmCancel.addEventListener("click",()=>{"function"==typeof v&&v(),i.modals.confirm.classList.add("hidden"),f=null,v=null}),i.buttons.confirmOk.addEventListener("click",()=>{"function"==typeof f&&f(),i.modals.confirm.classList.add("hidden"),f=null,v=null});let _=e=>{let t=e.getFullYear(),o=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getDate().toString().padStart(2,"0");return`${t}-${o}-${s}`};function k(){if(s.layout&&(s.layout=[...new Set(s.layout)]),s.customCards){let e=[],t=new Set;s.customCards.forEach(o=>{t.has(o.id)||(t.add(o.id),e.push(o))}),s.customCards=e}let o=new Set(s.customCards.map(e=>e.id)),a=["countdown","time","graph","tests","quote"];s.layout=s.layout.filter(e=>o.has(e)||a.includes(e)),s.save("layout"),s.save("customCards")}let w=()=>{let{examType:e,examYear:o,jeeSession:a,jeeShiftDate:r,customExamDate:n}=s.settings;if("Custom"===e)return n?new Date(n+"T00:00:00"):new Date;if("JEE"===e&&r)return new Date(r+"T00:00:00");if("JEE"===e){let i=t.JEE[a]?.[o]||`${o}-01-01`;return new Date(i+"T00:00:00")}let l=t.NEET[o]||`${o}-05-01`;return new Date(l+"T00:00:00")},S=e=>{let t=Math.floor(e/3600).toString().padStart(2,"0"),o=Math.floor(e%3600/60).toString().padStart(2,"0"),s=Math.floor(e%60).toString().padStart(2,"0");return`${t}:${o}:${s}`},E=e=>{let t=Math.floor(e/3600),o=Math.floor(e%3600/60),s="";return t>0&&(s+=`${t}h `),(o>0||t>0)&&(s+=`${o}m`),""===s&&(s=e%60+"s"),s.trim()};function L(){"visible"===document.visibilityState&&l&&l.close()}function C(){if(!l||!d)return;let e=document.querySelector(`[data-card-id="${d}"] .timer-display`),t=l.document.getElementById("pip-timer");e&&t&&(t.textContent=e.textContent)}function T(){if(!l||!d)return;let e=s.timeLoggerState[d];if(!e)return;let t=l.document.getElementById("pip-start-pause-btn"),o=l.document.getElementById("pip-log-btn");t&&(t.textContent=e.isRunning?"Pause":"Start"),o&&(o.disabled=e.accumulatedTime<60)}let I={countdown:{templateId:"countdown-template",isDefault:!0,render(e){let t=w()-new Date,o=e.querySelector("#countdown-timer");if(t<=0){o&&(o.innerHTML=`
                            <div class="flex flex-col items-center justify-center h-full py-4">
                                <span class="text-4xl md:text-6xl font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-br from-white to-[var(--accent-color)] drop-shadow-2xl animate-pulse select-none">
                                    IT'S TIME
                                </span>
                                
                                <div class="flex items-center gap-2 mt-2 opacity-80">
                                    <div class="h-[1px] w-8 bg-[var(--border-color)]"></div>
                                    <span class="text-xs md:text-sm text-[var(--text-secondary)] tracking-[0.3em] uppercase">
                                        So it begins ðŸ¥³ good luck!
                                    </span>
                                    <div class="h-[1px] w-8 bg-[var(--border-color)]"></div>
                                </div>
                            </div>
                        `);return}!e.querySelector('[data-value="days"]')&&o&&(o.innerHTML=`
                            <div><div data-value="days" class="font-bold">00</div><div class="text-xs sm:text-sm text-secondary">Days</div></div>
                            <div><div data-value="hours" class="font-bold">00</div><div class="text-xs sm:text-sm text-secondary">Hours</div></div>
                            <div><div data-value="minutes" class="font-bold">00</div><div class="text-xs sm:text-sm text-secondary">Minutes</div></div>
                        `),e.querySelector('[data-value="days"]').innerText=Math.floor(t/864e5).toString().padStart(2,"0"),e.querySelector('[data-value="hours"]').innerText=Math.floor(t/36e5%24).toString().padStart(2,"0"),e.querySelector('[data-value="minutes"]').innerText=Math.floor(t/6e4%60).toString().padStart(2,"0")}},time:{templateId:"time-template",isDefault:!0,render(e){let t=new Date;e.querySelector('[data-value="time"]').textContent=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}),e.querySelector('[data-value="date"]').textContent=t.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}},graph:{templateId:"graph-template",isDefault:!0,render(e){let t=e.querySelector("#contribution-graph");t.innerHTML="";let o=document.createDocumentFragment(),a=new Date;a.setHours(0,0,0,0);let r=new Date().getFullYear(),n=new Date(`${r}-01-01T00:00:00`),i=w();for(i.setHours(0,0,0,0);n<=i;){let l=document.createElement("div"),d=document.createElement("span"),c=_(n);l.className="day",l.dataset.date=c,d.className="tooltip";let u="day-future",m=`<strong class="text-accent">${n.toDateString()}</strong>`;n<a&&(u="day-past");let g=n.getTime();if(g===a.getTime()&&(u="day-today",m+="<br/><span class='text-xs text-gray-400'>(Today)</span>"),s.tests[c]){u="day-part-test";let p=s.tests[c].split("|").map(e=>`â€¢ ${e.trim()}`).join("<br/>"),h=Math.ceil((new Date(c)-a)/864e5),y=h>0?`${h} days left`:h<0?"Completed":"Today";m+=`<div class="mt-1 pt-1 border-t border-gray-700">${p}</div>`,m+=`<div class="text-[10px] text-gray-500 mt-1 italic">${y}</div>`}g===i.getTime()&&(u="day-exam",m+="<br/>\uD83D\uDEA8 <strong>EXAM DAY</strong> \uD83D\uDEA8"),l.classList.add(u),d.innerHTML=m,l.appendChild(d),o.appendChild(l),n.setDate(n.getDate()+1)}t.appendChild(o)}},tests:{templateId:"tests-template",isDefault:!0,render(e){let t=e.querySelector("#test-list");t.innerHTML="";let o=Object.keys(s.tests).sort();0!==o.length?o.forEach(e=>{let o=document.createElement("li");o.className="flex justify-between items-center bg-gray-800 p-2 rounded-md",o.innerHTML=`<div class="flex flex-col"><span class="font-semibold text-sm">${s.tests[e]}</span><span class="text-xs text-secondary">${new Date(e+"T00:00:00").toDateString()}</span></div><button data-date="${e}" class="delete-test-btn text-red-500 hover:text-red-400 font-semibold text-xs">Delete</button>`,t.appendChild(o)}):t.innerHTML='<li class="text-secondary px-2 text-sm">No tests scheduled.</li>'}},quote:{templateId:"quote-template",isDefault:!0,render(e){let t=a;"alakh-pandey"===s.settings.theme&&(t=r),"chaitanya-noob"===s.settings.theme&&(t=n);let{text:o,author:i}=t[Math.floor(Math.random()*t.length)];e.querySelector("#quote").textContent=`"${o}"`,e.querySelector("#author").textContent=`- ${i}`}},note:{templateId:"note-card-template",render(e,t){e.querySelector(".card-content").textContent=t.content}},todo:{templateId:"todo-card-template",render(e,t){let o=e.querySelector(".todo-list"),s=e.querySelector(".progress-bar"),a=e.querySelector(".progress-text");if(o.innerHTML="",Array.isArray(t.content)){let r=0,n=0;0===t.content.length?o.innerHTML='<li class="text-secondary text-xs text-center py-6 opacity-60">No active tasks. Time to focus.</li>':t.content.forEach((e,t)=>{e.priority||(e.priority="medium"),e.status||(e.status=e.completed?"done":"todo"),e.subtasks||(e.subtasks=[]),r++,"done"===e.status&&n++;let s={high:{color:"text-red-300",bg:"bg-red-500/20",border:"border-red-500/20",label:"High"},medium:{color:"text-amber-200",bg:"bg-amber-500/20",border:"border-amber-500/20",label:"Medium"},low:{color:"text-blue-200",bg:"bg-blue-500/20",border:"border-blue-500/20",label:"Low"}}[e.priority],a=document.createElement("li");a.className="group mb-2 rounded-xl bg-white/5 hover:bg-white/10 transition-all overflow-hidden relative",a.dataset.index=t;let i=e.subtasks.map((e,t)=>`
                                <div class="flex items-center gap-3 py-1.5 pl-2 group/sub relative">
                                    <div class="absolute left-[-6px] top-1/2 w-2 h-px bg-gray-700"></div>
                                    <button class="toggle-subtask-btn w-3.5 h-3.5 flex-shrink-0 border border-gray-500 rounded flex items-center justify-center transition-colors ${e.completed?"bg-gray-500 border-gray-500":"hover:border-gray-300"}" data-sub-index="${t}">
                                        ${e.completed?'<svg class="w-2.5 h-2.5 text-white" viewBox="0 0 12 10" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 5L4 8L11 1"/></svg>':""}
                                    </button>
                                    <span class="text-xs ${e.completed?"line-through text-gray-500":"text-gray-300"} flex-grow break-all font-medium">${e.text}</span>
                                    <button class="delete-subtask-btn text-gray-500 hover:text-red-400 opacity-0 group-hover/sub:opacity-100 px-1.5 transition-opacity text-lg leading-none" data-sub-index="${t}">\xd7</button>
                                </div>
                            `).join("");a.innerHTML=`
                                <div class="flex items-start gap-3 p-3.5">
                                    <button class="status-btn mt-0.5 flex-shrink-0 transform active:scale-95 transition-transform" 
                                            data-tooltip="${"todo"===e.status?"Start Task":"in-progress"===e.status?"Complete":"Reset"}">
                                        ${({todo:'<div class="w-4 h-4 rounded-full border-[1.5px] border-gray-400 hover:border-white transition-colors"></div>',"in-progress":'<div class="w-4 h-4 rounded-full border-[1.5px] border-amber-400 flex items-center justify-center"><div class="w-1.5 h-1.5 bg-amber-400 rounded-full animate-pulse"></div></div>',done:'<div class="w-4 h-4 rounded-full bg-[var(--accent-color)] border border-[var(--accent-color)] flex items-center justify-center text-white"><svg width="10" height="8" viewBox="0 0 12 10" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M1 5L4 8L11 1"/></svg></div>'})[e.status]}
                                    </button>
                                    
                                    <div class="flex-grow min-w-0 flex flex-col toggle-expand-btn cursor-pointer">
                                        <div class="flex items-center justify-between gap-2">
                                            <span class="text-sm font-semibold leading-tight transition-colors ${"done"===e.status?"line-through text-gray-500 decoration-gray-500":"text-gray-100 group-hover:text-white"}">
                                                ${e.text}
                                            </span>
                                        </div>
                                        
                                        <div class="flex items-center gap-2 mt-2">
                                            <button class="priority-btn text-[10px] font-bold tracking-wide px-2 py-0.5 rounded-full border ${s.border} ${s.color} ${s.bg} hover:brightness-125 transition-all uppercase"
                                                    data-tooltip="Priority: ${s.label}">
                                                ${s.label}
                                            </button>
                                            
                                            ${e.subtasks.length>0?`
                                                <span class="text-[10px] text-gray-400 font-medium flex items-center gap-1 bg-white/5 px-2 py-0.5 rounded-full">
                                                    <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/></svg>
                                                    ${e.subtasks.filter(e=>e.completed).length}/${e.subtasks.length}
                                                </span>
                                            `:""}
                                        </div>
                                    </div>

                                    <button class="delete-todo-item text-gray-500 hover:text-red-400 p-1 opacity-0 group-hover:opacity-100 transition-opacity absolute top-3 right-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                                    </button>
                                </div>
                                
                                <div class="subtasks-section ${e.expanded?"block":"hidden"} pl-10 pr-4 pb-3 border-t border-white/5 bg-black/20">
                                    <div class="space-y-0.5 mt-2">
                                        ${i}
                                    </div>
                                    <form class="add-subtask-form flex gap-2 mt-2 items-center opacity-70 hover:opacity-100 transition-opacity">
                                        <span class="text-gray-500 text-lg leading-none">+</span>
                                        <input type="text" placeholder="Add step..." class="bg-transparent border-none text-xs w-full focus:outline-none focus:placeholder-gray-400 placeholder-gray-600 text-gray-300 py-1 font-medium">
                                    </form>
                                </div>
                            `,o.appendChild(a)});let i=r>0?Math.round(n/r*100):0;s.style.width=`${i}%`,a.className="progress-text text-[10px] text-gray-400 font-bold",a.textContent=`${i}%`}}},"line-graph":{templateId:"line-graph-card-template",render(e,t){let o=e.querySelector(".marks-list");o.innerHTML="";let a=0,r=0,n=0,i=0,l=[...t.content].reverse();l.forEach((e,s)=>{let l=t.content.length-1-s,d=e.total??e.marks;a+=d,r++,d>n&&(n=d),0===s&&(i=d);let c=e.subjects||{},u=c.physics||0,m=c.chemistry||0,g=c.maths||0,p=t.targetScore||0,h=!(p>0)||d>=p,y=document.createElement("li");y.className="group flex flex-col bg-white/5 hover:bg-white/10 border border-transparent hover:border-gray-600 rounded-lg p-2 transition-all",y.innerHTML=`
                        <div class="flex justify-between items-center mb-1">
                            <div class="flex items-center gap-2">
                                <span class="font-bold text-sm text-white">${e.name}</span>
                                ${h&&p>0?'<span class="text-[9px] bg-green-500/20 text-green-400 px-1.5 rounded">Hit</span>':""}
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-sm font-bold ${h?"text-white":"text-yellow-500"}">${d}</span>
                                <span class="text-[10px] text-secondary">/${e.maxMarks}</span>
                                <button data-index="${l}" class="delete-mark-item opacity-0 group-hover:opacity-100 text-gray-500 hover:text-red-500 transition-opacity p-1 ml-1" aria-label="Delete">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                                </button>
                            </div>
                        </div>
                        
                        <div class="flex gap-1.5 mt-1">
                            <span class="subject-pill phy" title="Physics">P: ${u}</span>
                            <span class="subject-pill chem" title="Chemistry">C: ${m}</span>
                            <span class="subject-pill math" title="Maths">M: ${g}</span>
                        </div>
                    `,o.appendChild(y)});let d=r>0?(a/r).toFixed(0):0;e.querySelector(".mean-score-display").textContent=d,e.querySelector(".max-score-display").textContent=n;let c=e.querySelector(".trend-display");if(r>0){let u=i-d;u>0?c.innerHTML=`<span class="text-green-400 flex items-center justify-center gap-1">â–² ${Math.abs(u).toFixed(0)}</span>`:u<0?c.innerHTML=`<span class="text-red-400 flex items-center justify-center gap-1">â–¼ ${Math.abs(u).toFixed(0)}</span>`:c.innerHTML='<span class="text-gray-400">~</span>'}else c.innerHTML="-";let m=e.querySelector(".toggle-add-marks-form"),g=e.querySelector(".add-marks-form"),p=m.cloneNode(!0);m.parentNode.replaceChild(p,m),p.addEventListener("click",()=>{g.classList.toggle("hidden");let e=g.classList.contains("hidden");p.innerHTML=e?'<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg> Add Test Score':'<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg> Cancel'});let h=e.querySelector(".target-score-input");h.value=t.targetScore||"";let y=h.cloneNode(!0);h.parentNode.replaceChild(y,h),y.addEventListener("change",o=>{let a=parseFloat(o.target.value);t.targetScore=isNaN(a)?0:a,s.save("customCards"),I["line-graph"].render(e,t)});let $=e.querySelector(".marks-chart").getContext("2d");s.chartInstances[t.id]&&s.chartInstances[t.id].destroy();let b=getComputedStyle(document.documentElement),f=b.getPropertyValue("--accent-color").trim()||"#3b82f6",v=(e=>{let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?`${parseInt(t[1],16)}, ${parseInt(t[2],16)}, ${parseInt(t[3],16)}`:"56, 189, 248"})(f),x=(e,t)=>{let o=e.createLinearGradient(0,0,0,300);return o.addColorStop(0,`rgba(${t}, 0.4)`),o.addColorStop(1,`rgba(${t}, 0)`),o},_={total:{color:f,rgb:v},physics:{color:"#60a5fa",rgb:"96, 165, 250"},chemistry:{color:"#34d399",rgb:"52, 211, 153"},maths:{color:"#fb923c",rgb:"251, 146, 60"}},k=["total","physics","chemistry","maths"].map(e=>{let o=_[e];return{label:e.charAt(0).toUpperCase()+e.slice(1),data:t.content.map(t=>"total"===e?t.total??t.marks:t.subjects?t.subjects[e]:0),borderColor:o.color,backgroundColor:x($,o.rgb),fill:"total"===e,tension:.4,pointRadius:4,pointBackgroundColor:"#18181b",pointBorderColor:o.color,pointBorderWidth:2,pointHoverRadius:6,pointHoverBackgroundColor:o.color,pointHoverBorderColor:"#fff",borderWidth:2,hidden:"total"!==e}});t.targetScore&&t.targetScore>0&&k.push({label:"Target",data:Array(t.content.length).fill(t.targetScore),borderColor:"#ef4444",borderDash:[5,5],pointRadius:0,borderWidth:1,fill:!1});let w=t.content.length>0?Math.max(...t.content.map(e=>e.maxMarks||300)):300,S=new Chart($,{type:"line",data:{labels:t.content.map(e=>e.name),datasets:k},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(24, 24, 27, 0.95)",titleColor:"#fff",bodyColor:"#9ca3af",borderColor:"rgba(255,255,255,0.1)",borderWidth:1,padding:10,displayColors:!0,callbacks:{label:function(e){return` ${e.dataset.label}: ${e.raw}`}}}},scales:{y:{beginAtZero:!0,max:w,grid:{color:"rgba(255, 255, 255, 0.05)",drawBorder:!1},ticks:{color:"#6b7280",font:{size:10}}},x:{grid:{display:!1},ticks:{color:"#6b7280",font:{size:10}}}}}});s.chartInstances[t.id]=S;let E=e.querySelector(".chart-toggles"),L=E.cloneNode(!0);E.parentNode.replaceChild(L,E),L.addEventListener("click",e=>{if("BUTTON"===e.target.tagName){let t=e.target.dataset.subject,o=S.data.datasets.findIndex(e=>e.label.toLowerCase().includes("maths"===t?"math":t));if(o>-1){let s=S.getDatasetMeta(o);s.hidden=null===s.hidden?!S.data.datasets[o].hidden:null,S.update();let a=e.target,r=S.isDatasetVisible(o);r?"total"===t?(a.style.backgroundColor="var(--accent-color)",a.style.color="white",a.style.borderColor="var(--accent-color)"):"physics"===t?(a.style.backgroundColor="rgba(59, 130, 246, 0.2)",a.style.color="#60a5fa",a.style.borderColor="#60a5fa"):"chemistry"===t?(a.style.backgroundColor="rgba(16, 185, 129, 0.2)",a.style.color="#34d399",a.style.borderColor="#34d399"):"maths"===t&&(a.style.backgroundColor="rgba(249, 115, 22, 0.2)",a.style.color="#fb923c",a.style.borderColor="#fb923c"):(a.style.backgroundColor="rgba(31, 41, 55, 0.5)",a.style.color="var(--text-secondary)",a.style.borderColor="#4b5563")}}})}},pomodoro:{templateId:"pomodoro-card-template",render(e,t){let o=s.pomodoroState[t.id]||{mode:"pomodoro",time:1500,isRunning:!1,intervalId:null,durations:{pomodoro:25,shortBreak:5,longBreak:15}};s.pomodoroState[t.id]=o;let a=Math.floor(o.time/60).toString().padStart(2,"0"),r=(o.time%60).toString().padStart(2,"0");e.querySelector(".timer-display").textContent=`${a}:${r}`,e.querySelectorAll(".pomodoro-btn").forEach(e=>{e.classList.toggle("active",e.dataset.mode===o.mode)}),e.querySelector(".start-pause-btn").textContent=o.isRunning?"PAUSE":"START",e.querySelector('[data-mode="pomodoro"].pomodoro-duration-input').value=o.durations.pomodoro,e.querySelector('[data-mode="shortBreak"].pomodoro-duration-input').value=o.durations.shortBreak,e.querySelector('[data-mode="longBreak"].pomodoro-duration-input').value=o.durations.longBreak}},youtube:{templateId:"youtube-card-template",render(e,t){let o=e.querySelector(".youtube-iframe"),a=t.content,r="";if(a)try{let n=new URL(a);r=n.hostname.includes("youtu.be")?n.pathname.slice(1):n.searchParams.get("v")}catch(i){console.error("Invalid YouTube URL")}o.src=r?`https://www.youtube.com/embed/${r}`:"";let l=e.querySelector(".youtube-container");l.classList.toggle("tint-disabled",!s.settings.youtubeTintEnabled),l.classList.toggle("blurred",s.settings.youtubeBlurEnabled)}},analytics:{templateId:"analytics-card-template",render(e,t){let o=e=>{let t=[],o=[],a=0;for(let r=e-1;r>=0;r--){let n=new Date;n.setDate(n.getDate()-r);let i=n.getFullYear(),l=(n.getMonth()+1).toString().padStart(2,"0"),d=n.getDate().toString().padStart(2,"0"),c=`${i}-${l}-${d}`,u=7===e?n.toLocaleDateString("en-US",{weekday:"short"}):n.toLocaleDateString("en-US",{day:"numeric",month:"short"});t.push(u);let m=0;s.studyLogs[c]&&Object.values(s.studyLogs[c]).forEach(e=>m+=e),o.push(m/3600),a+=m}return{labels:t,dataPoints:o,totalSecondsRange:a}},a=e.querySelector(".analytics-chart").getContext("2d"),r=e.querySelectorAll(".range-btn"),n=getComputedStyle(document.documentElement),i=n.getPropertyValue("--accent-color").trim()||"#3b82f6",l=n.getPropertyValue("--text-secondary").trim()||"#8b949e",d=n.getPropertyValue("--border-color").trim()||"#30363d",c=n=>{let{labels:c,dataPoints:u,totalSecondsRange:m}=o(n),g=Math.floor(m/3600),p=Math.floor(m%3600/60),h=g>0?`${g}h ${p}m`:`${p}m`,y=(m/3600/n).toFixed(2),$=e.querySelector(".statistics-summary");$&&($.innerHTML=`

                                    <span class="mr-4">Total: <strong style="color:${i}">${h}</strong></span>

                                    <span>Average: <strong>${y}h/day</strong></span>

                                `),s.chartInstances[t.id]&&s.chartInstances[t.id].destroy(),s.chartInstances[t.id]=new Chart(a,{type:"bar",data:{labels:c,datasets:[{label:"Hours",data:u,backgroundColor:i,hoverBackgroundColor:i,borderRadius:4,barPercentage:.6}]},options:{responsive:!0,maintainAspectRatio:!1,animation:{duration:0},plugins:{legend:{display:!1},tooltip:{callbacks:{label(e){let t=e.raw;return t>0&&t<1?` ${Math.round(60*t)} mins`:` ${t.toFixed(2)} hrs`}}}},scales:{y:{beginAtZero:!0,grid:{color:d,drawBorder:!1},border:{display:!1},ticks:{color:l,callback:e=>(e%1==0?e:e.toFixed(1))+"h"}},x:{grid:{display:!1,drawBorder:!1},ticks:{color:l}}}}}),r.forEach(e=>{parseInt(e.dataset.range)===n?(e.style.backgroundColor=i,e.style.borderColor=i,e.style.color="#fff"):(e.style.backgroundColor="transparent",e.style.borderColor=d,e.style.color=l)})};c(7),r.forEach(e=>{e.addEventListener("click",e=>{let t=parseInt(e.target.dataset.range);c(t)})})}},"daily-tasks":{templateId:"daily-tasks-template",render(e,t){(!t.content||Array.isArray(t.content))&&(t.content={});let o=e.querySelector(".daily-date-selector");o.value||(o.value=e.dataset.selectedDate||new Date().toISOString().split("T")[0]),e.dataset.selectedDate=o.value;let s=o.value,a=t.content[s]||[],r=e.querySelector(".daily-task-list"),n=e.querySelector(".progress-bar"),i=e.querySelector(".progress-text");r.innerHTML="";let l=0,d=0;0===a.length?r.innerHTML=`<li class="text-secondary text-xs text-center py-8 opacity-50 flex flex-col items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                        <span>No plans for ${new Date(s).toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"})}</span>
                    </li>`:a.forEach((e,t)=>{e.priority||(e.priority="medium"),e.status||(e.status=e.completed?"done":"todo"),e.subtasks||(e.subtasks=[]),l++,"done"===e.status&&d++;let o={high:{color:"text-red-300",bg:"bg-red-500/20",border:"border-red-500/20",label:"High"},medium:{color:"text-amber-200",bg:"bg-amber-500/20",border:"border-amber-500/20",label:"Medium"},low:{color:"text-blue-200",bg:"bg-blue-500/20",border:"border-blue-500/20",label:"Low"}}[e.priority],s=e.subtasks.map((e,t)=>`
                            <div class="flex items-center gap-3 py-1.5 pl-2 group/sub relative">
                                <div class="absolute left-[-6px] top-1/2 w-2 h-px bg-gray-700"></div>
                                <button class="toggle-subtask-btn w-3.5 h-3.5 flex-shrink-0 border border-gray-500 rounded flex items-center justify-center transition-colors ${e.completed?"bg-gray-500 border-gray-500":"hover:border-gray-300"}" data-sub-index="${t}">
                                    ${e.completed?'<svg class="w-2.5 h-2.5 text-white" viewBox="0 0 12 10" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 5L4 8L11 1"/></svg>':""}
                                </button>
                                <span class="text-xs ${e.completed?"line-through text-gray-500":"text-gray-300"} flex-grow break-all font-medium">${e.text}</span>
                                <button class="delete-subtask-btn text-gray-500 hover:text-red-400 opacity-0 group-hover/sub:opacity-100 px-1.5 transition-opacity text-lg leading-none" data-sub-index="${t}">\xd7</button>
                            </div>
                        `).join(""),a=document.createElement("li");a.className="group mb-2 rounded-xl bg-white/5 hover:bg-white/10 transition-all overflow-hidden relative",a.dataset.index=t,a.innerHTML=`
                            <div class="flex items-start gap-3 p-3.5">
                                <button class="status-btn mt-0.5 flex-shrink-0 transform active:scale-95 transition-transform">
                                    ${({todo:'<div class="w-4 h-4 rounded-full border-[1.5px] border-gray-400 hover:border-white transition-colors"></div>',"in-progress":'<div class="w-4 h-4 rounded-full border-[1.5px] border-amber-400 flex items-center justify-center"><div class="w-1.5 h-1.5 bg-amber-400 rounded-full animate-pulse"></div></div>',done:'<div class="w-4 h-4 rounded-full bg-[var(--accent-color)] border border-[var(--accent-color)] flex items-center justify-center text-white"><svg width="10" height="8" viewBox="0 0 12 10" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M1 5L4 8L11 1"/></svg></div>'})[e.status]}
                                </button>
                                
                                <div class="flex-grow min-w-0 flex flex-col toggle-expand-btn cursor-pointer">
                                    <div class="flex items-center justify-between gap-2">
                                        <span class="text-sm font-semibold leading-tight transition-colors ${"done"===e.status?"line-through text-gray-500 decoration-gray-500":"text-gray-100 group-hover:text-white"}">
                                            ${e.text}
                                        </span>
                                    </div>
                                    
                                    <div class="flex items-center gap-2 mt-2">
                                        <button class="priority-btn text-[10px] font-bold tracking-wide px-2 py-0.5 rounded-full border ${o.border} ${o.color} ${o.bg} hover:brightness-125 transition-all uppercase">
                                            ${o.label}
                                        </button>
                                        ${e.subtasks.length>0?`
                                            <span class="text-[10px] text-gray-400 font-medium flex items-center gap-1 bg-white/5 px-2 py-0.5 rounded-full">
                                                <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/></svg>
                                                ${e.subtasks.filter(e=>e.completed).length}/${e.subtasks.length}
                                            </span>
                                        `:""}
                                    </div>
                                </div>

                                <button class="delete-daily-task text-gray-500 hover:text-red-400 p-1 opacity-0 group-hover:opacity-100 transition-opacity absolute top-3 right-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                                </button>
                            </div>
                            
                            <div class="subtasks-section ${e.expanded?"block":"hidden"} pl-10 pr-4 pb-3 border-t border-white/5 bg-black/20">
                                <div class="space-y-0.5 mt-2">
                                    ${s}
                                </div>
                                <form class="add-subtask-form flex gap-2 mt-2 items-center opacity-70 hover:opacity-100 transition-opacity">
                                    <span class="text-gray-500 text-lg leading-none">+</span>
                                    <input type="text" placeholder="Add step..." class="bg-transparent border-none text-xs w-full focus:outline-none focus:placeholder-gray-400 placeholder-gray-600 text-gray-300 py-1 font-medium">
                                </form>
                            </div>
                        `,r.appendChild(a)});let c=l>0?Math.round(d/l*100):0;n.style.width=`${c}%`,i.textContent=`${c}%`}},ambient:{templateId:"ambient-card-template",render(e,t){if(!window.ambientSounds){window.ambientSounds={pink:new Tone.Noise("pink").toDestination(),brown:new Tone.Noise("brown").toDestination(),white:new Tone.Noise("white").toDestination()};let o=new Tone.Filter(1500,"lowpass").toDestination();window.ambientSounds.white.disconnect().connect(o),Object.values(window.ambientSounds).forEach(e=>{e.volume.value=-1/0,e.start()})}(!t.content||"object"!=typeof t.content||Array.isArray(t.content))&&(t.content={pink:-60,brown:-60,white:-60,isGlobalPaused:!0});let a=e.querySelector(".ambient-toggle-btn"),r=a.querySelector(".play-icon"),n=a.querySelector(".pause-icon"),i=e=>{e?(r.classList.remove("hidden"),n.classList.add("hidden"),a.title="Play All"):(r.classList.add("hidden"),n.classList.remove("hidden"),a.title="Pause All")};i(t.content.isGlobalPaused),a.onclick=()=>{let o=!t.content.isGlobalPaused;t.content.isGlobalPaused=o,o?Object.values(window.ambientSounds).forEach(e=>e.volume.rampTo(-1/0,.5)):("running"!==Tone.context.state&&Tone.start(),e.querySelectorAll(".ambient-slider").forEach(e=>{let t=e.dataset.type,o=parseInt(e.value);o>-59&&window.ambientSounds[t].volume.rampTo(o,.5)})),i(o),s.save("customCards")},e.querySelectorAll(".ambient-slider").forEach(e=>{let o=e.dataset.type;e.setAttribute("draggable","false"),e.addEventListener("dragstart",e=>{e.preventDefault(),e.stopPropagation()}),e.addEventListener("mousedown",e=>{e.stopPropagation()});let a=t.content[o]||-60;if(e.value=a,!t.content.isGlobalPaused){let r=window.ambientSounds[o].volume.value,n=-59>=parseInt(a)?-1/0:parseInt(a);r<n&&n>-60&&window.ambientSounds[o].volume.rampTo(n,.1)}e.oninput=e=>{let s=parseInt(e.target.value);t.content[o]=s,t.content.isGlobalPaused&&s>-59&&(t.content.isGlobalPaused=!1,i(!1)),"running"!==Tone.context.state&&Tone.start(),t.content.isGlobalPaused||(s<=-59?window.ambientSounds[o].volume.rampTo(-1/0,.1):window.ambientSounds[o].volume.rampTo(s,.1))},e.onchange=e=>{s.save("customCards")}})}},"time-logger":{templateId:"time-logger-card-template",render(e,t){let o=s.timeLoggerState[t.id]||{isRunning:!1,accumulatedTime:0,currentSubject:"Physics",intervalId:null};s.timeLoggerState[t.id]=o,e.querySelector(".timer-display").textContent=S(o.accumulatedTime),e.querySelector(".start-pause-btn").textContent=o.isRunning?"PAUSE":"START";let a=`subject-select-${t.id}`,r=e.querySelector(".subject-select"),n=r.previousElementSibling;n&&"LABEL"===n.tagName&&n.setAttribute("for",a),r.id=a;let i=[...new Set(["Physics","Chemistry","Maths","Biology","Zoology","Botany",...s.settings.userSubjects||[],]),];r.innerHTML=i.map(e=>`<option>${e}</option>`).join("")+'<option value="add_new">Add New Subject...</option>',r.value=o.currentSubject;let l=e.querySelector(".manual-subject-select");l&&(l.innerHTML=i.map(e=>`<option>${e}</option>`).join(""),l.value=o.currentSubject);let d=e.querySelector(".study-log-list"),c=e.querySelector(".total-study-time");d.innerHTML="";let u=_(new Date),m=s.studyLogs[u]||{},g=Object.values(m).reduce((e,t)=>e+t,0);c&&(c.textContent=`Total: ${E(g)}`),0===Object.keys(m).length?d.innerHTML='<li class="text-secondary px-2 text-sm">No sessions logged today.</li>':Object.entries(m).forEach(([e,t])=>{let o=document.createElement("li");o.className="flex justify-between items-center",o.innerHTML=`<span>${e}</span><div class="flex items-center gap-2"><span class="font-semibold">${E(t)}</span><button data-subject="${e}" class="delete-log-item text-red-500 hover:text-red-400 font-semibold px-2 py-1 text-xs leading-none rounded-sm" aria-label="Delete ${e} log">\xd7</button></div>`,d.appendChild(o)})}}};function q(){Object.values(s.chartInstances).forEach(e=>e.destroy()),s.chartInstances={},i.dashboardGrid.innerHTML="";let e=!1,t=s.customCards.map(e=>e.id);Array.isArray(s.layout)||(s.layout=["countdown","graph","default-todo","default-study-logger","default-note","default-line-graph","tests","quote","time",],e=!0);let o=s.layout.length;s.layout=s.layout.filter(e=>I[e]?.isDefault||t.includes(e)),s.layout.length!==o&&(e=!0),s.customCards.forEach(e=>{s.layout.includes(e.id)||s.layout.push(e.id)}),document.getElementById("dashboard-grid").onmousemove=e=>{for(let t of document.getElementsByClassName("card")){let o=t.getBoundingClientRect(),s=e.clientX-o.left,a=e.clientY-o.top;t.style.setProperty("--mouse-x",`${s}px`),t.style.setProperty("--mouse-y",`${a}px`)}},k(),s.save("layout"),s.layout.forEach(e=>{let t=s.customCards.find(t=>t.id===e),o=t?t.type:e,a=I[o];if(a){let r=document.getElementById(a.templateId).content.cloneNode(!0),n=r.querySelector(".card");n.dataset.cardId=e;let l=s.cardProps[e]||{colspan:"graph"===o||"line-graph"===o||"youtube"===o||"time-logger"===o?2:1};if(s.cardProps[e]=l,2===l.colspan&&n.classList.add("md:col-span-2"),t)n.querySelector(".card-title").textContent=t.title;else if("chaitanya-noob"===s.settings.theme){let d=n.querySelector("h2");d&&(d.textContent+=" \uD83E\uDD13")}i.dashboardGrid.appendChild(r)}}),i.dashboardGrid.querySelectorAll(".card").forEach((e,t)=>{let o=e.dataset.cardId,a=s.customCards.find(e=>e.id===o),r=a?a.type:o,n=I[r];n&&n.render&&n.render(e,a)})}function B(){let e=s.settings.youtubeTintEnabled,t=s.settings.youtubeBlurEnabled;i.inputs.youtubeTintToggle&&(i.inputs.youtubeTintToggle.checked=e),i.inputs.youtubeBlurToggle&&(i.inputs.youtubeBlurToggle.checked=t),document.querySelectorAll('[data-card-type="youtube"] .youtube-container').forEach(o=>{o.classList.toggle("tint-disabled",!e),o.classList.toggle("blurred",t)})}function M(){document.documentElement.dataset.theme=s.settings.theme;let e=["cyberpunk","god-mode"].includes(s.settings.theme)?s.settings.theme:"";document.documentElement.dataset.subTheme=e,document.documentElement.dataset.ricedMode=s.settings.ricedModeEnabled?"true":"false",i.body.style.fontFamily=s.settings.font,"alakh-pandey"===s.settings.theme?i.body.style.backgroundImage="url(https://i.imgflip.com/8otyfs.jpg)":"chaitanya-noob"===s.settings.theme?i.body.style.backgroundImage="url(https://i.ibb.co/pv4BYhMs/Whats-App-Image-2025-08-06-at-16-12-41-4f47e159.jpg)":"god-mode"===s.settings.theme?i.body.style.backgroundImage="url('https://i.pinimg.com/originals/c5/9a/d2/c59ad2bd4ad2fbacd04017debc679ddb.gif')":i.body.style.backgroundImage=s.settings.bgUrl?`url(${s.settings.bgUrl})`:"none";let o=s.settings.jeeSession||"April",a=s.settings.examYear||"2026";i.inputs.jeeSession&&0===i.inputs.jeeSession.options.length&&["January","April"].forEach(e=>{let t=document.createElement("option");t.value=e,t.textContent=e,i.inputs.jeeSession.appendChild(t)}),i.inputs.jeeSession.value=o;let r=t.JEE[o]?.[a]||"";i.inputs.customName.value=s.settings.customExamName||"",i.inputs.customDate.value=s.settings.customExamDate||"",i.inputs.jeeShift.value=s.settings.jeeShiftDate||r,"JEE"===s.settings.examType?(i.inputs.jeeContainer.classList.remove("hidden"),i.inputs.customContainer.classList.add("hidden")):"Custom"===s.settings.examType?(i.inputs.jeeContainer.classList.add("hidden"),i.inputs.customContainer.classList.remove("hidden")):(i.inputs.jeeContainer.classList.add("hidden"),i.inputs.customContainer.classList.add("hidden"));let{examType:n,examYear:l,customExamName:d}=s.settings,c;c="Custom"===n?d||"My Exam":`${n} ${l}`,i.mainTitle.textContent=c,i.mainTitleRiced.textContent=c,i.inputs.tickingSoundToggle.checked=s.settings.tickingSoundEnabled,i.inputs.theme.value=s.settings.theme,i.inputs.font.value=s.settings.font,i.inputs.bgUrl.value=s.settings.bgUrl,i.inputs.examType.value=s.settings.examType,i.inputs.examYear.value=s.settings.examYear,i.inputs.focusShieldToggle.checked=s.settings.focusShieldEnabled,i.inputs.ricedModeToggle.checked=s.settings.ricedModeEnabled,B(),document.documentElement.dataset.streamlinedMode=s.settings.streamlinedModeEnabled?"true":"false",i.inputs.streamlinedModeToggle&&(i.inputs.streamlinedModeToggle.checked=s.settings.streamlinedModeEnabled)}async function j(e,t){if("documentPictureInPicture"in window){l&&l.close();try{let o=await documentPictureInPicture.requestWindow({width:320,height:155});l=o,d=e,c=t,[...document.styleSheets].forEach(e=>{if(e.href){let t=document.createElement("link");t.rel="stylesheet",t.href=e.href,l.document.head.appendChild(t)}else if(e.ownerNode){let o=e.ownerNode.cloneNode(!0);l.document.head.appendChild(o)}});let s=document.createElement("style");s.textContent=`

                            body {

                                background-color: #000000;

                                color: var(--text-primary);

                                font-family: var(--font-family);

                                display: flex;

                                flex-direction: column;

                                align-items: center;

                                justify-content: center;

                                text-align: center;

                                padding: 1rem;

                                margin: 0;

                                box-sizing: border-box;

                                overflow: hidden;

                            }

                            h2 {

                                font-size: 0.9rem;

                                margin: 0 0 0.5rem 0;

                                color: var(--text-secondary);

                                font-weight: 600;

                            }

                            #pip-timer {

                                

                                font-size: clamp(1.5rem, 25vh, 7.5rem);

                                font-weight: 700;

                                line-height: 1; /* Helps with vertical alignment */

                                letter-spacing: 0.05em;

                                font-family: 'Fira Code', monospace;

                            }

                            #pip-controls {

                                display: flex;

                                gap: 0.75rem;

                                margin-top: 1rem;

                            }

                            #pip-controls button {

                                padding: 0.5rem 1.25rem;

                                font-size: 0.9rem;

                                font-weight: 600;

                                border: none;

                                border-radius: 8px;

                                cursor: pointer;

                                transition: transform 0.1s ease, filter 0.1s ease;

                            }

                            #pip-controls button:hover {

                                transform: translateY(-2px);

                                filter: brightness(1.1);

                            }

                            #pip-start-pause-btn {

                                background-color: var(--accent-color);

                                color: white; /* Default to white for most themes */

                            }

                            #pip-log-btn {

                                background-color: #16a34a; /* A nice, consistent green */

                                color: white;

                            }

                            #pip-log-btn:disabled {

                                background-color: #4b5563; /* Gray out when disabled */

                                cursor: not-allowed;

                                transform: none;

                                filter: none;

                            }

                            #pip-reset-btn {

                                background-color: transparent;

                                color: var(--text-secondary);

                            }

                            /* Fix for themes where button text should be dark */

                            [data-theme="light"] #pip-start-pause-btn,

                            [data-theme="alakh-pandey"] #pip-start-pause-btn {

                                color: var(--bg-color);

                            }

                        `,l.document.head.appendChild(s);let a=document.documentElement.dataset.theme;a&&"default"!==a&&(l.document.documentElement.dataset.theme=a);let r=document.createElement("h2");r.textContent=document.querySelector(`[data-card-id="${e}"] .card-title`).textContent;let n=document.createElement("div");n.id="pip-timer";let i=document.createElement("div");i.id="pip-controls";let u=document.createElement("button");u.id="pip-start-pause-btn",u.addEventListener("click",()=>window.timeLogger.toggle(d));let m=document.createElement("button");m.id="pip-log-btn",m.textContent="Log",m.addEventListener("click",()=>window.timeLogger.log(d));let g=document.createElement("button");g.id="pip-reset-btn",g.textContent="Reset",g.addEventListener("click",()=>window.timeLogger.reset(d)),i.append(u,m,g),l.document.body.append(r,n,i),document.addEventListener("visibilitychange",L),l.addEventListener("pagehide",()=>{l=null,d=null,c=null,document.removeEventListener("visibilitychange",L)}),C(),T()}catch(p){console.error("PiP Error:",p),l=null}}else alert("Your browser does not support the Document Picture-in-Picture API required for this feature. Please try a recent version of Chrome or Edge on a desktop computer.")}i.dashboardGrid.addEventListener("click",e=>{let t=e.target.closest(".card");if(!t)return;let o=t.dataset.cardId;if("quote"===o&&I.quote.render&&I.quote.render(t),e.target.closest(".delete-test-btn")){let a=e.target.closest(".delete-test-btn").dataset.date;delete s.tests[a],s.save("tests"),q()}if(e.target.classList.contains("day")){let r=e.target.dataset.date;if(s.tests[r])delete s.tests[r],s.save("tests"),q();else{let n=i.dashboardGrid.querySelector("#add-test-form");n&&(n.date.value=r,n.name.focus())}}let l=s.customCards.find(e=>e.id===o);if(e.target.closest(".toggle-colspan-btn")){let d=s.cardProps[o]||{colspan:1};d.colspan=2===d.colspan?1:2,s.cardProps[o]=d,s.save("cardProps"),q()}if(e.target.closest(".delete-card-btn")&&l&&(s.customCards=s.customCards.filter(e=>e.id!==o),delete s.cardProps[o],delete s.pomodoroState[o],delete s.timeLoggerState[o],s.save("customCards"),s.save("cardProps"),s.save("pomodoroState"),s.save("timeLoggerState"),q()),e.target.classList.contains("delete-log-item")){let c=e.target.closest(".card"),u=c.dataset.cardId,m=e.target.dataset.subject,g=_(new Date);if(s.studyLogs[g]&&void 0!==s.studyLogs[g][m]){delete s.studyLogs[g][m],0===Object.keys(s.studyLogs[g]).length&&delete s.studyLogs[g],s.save("studyLogs");let p=s.customCards.find(e=>e.id===u);I["time-logger"].render(c,p)}}if(l&&"todo"===l.type){let h=e.target.closest("li");if(h){let y=parseInt(h.dataset.index),$=l.content[y];if(e.target.closest(".status-btn")){let b=["todo","in-progress","done"],f=b.indexOf($.status||"todo");$.status=b[(f+1)%3],$.completed="done"===$.status,s.save("customCards"),I.todo.render(t,l)}else if(e.target.closest(".priority-btn")){let v=["medium","high","low"],x=v.indexOf($.priority||"medium");$.priority=v[(x+1)%3],s.save("customCards"),I.todo.render(t,l)}else if(e.target.closest(".toggle-expand-btn"))$.expanded=!$.expanded,s.save("customCards"),I.todo.render(t,l);else if(e.target.closest(".toggle-subtask-btn")){let k=parseInt(e.target.closest(".toggle-subtask-btn").dataset.subIndex);$.subtasks[k]&&($.subtasks[k].completed=!$.subtasks[k].completed,s.save("customCards"),I.todo.render(t,l))}else if(e.target.closest(".delete-subtask-btn")){let w=parseInt(e.target.closest(".delete-subtask-btn").dataset.subIndex);$.subtasks.splice(w,1),s.save("customCards"),I.todo.render(t,l)}else e.target.closest(".delete-todo-item")&&(l.content.splice(y,1),s.save("customCards"),I.todo.render(t,l))}}if(e.target.closest(".pip-btn")){let S=s.customCards.find(e=>e.id===o);S&&"time-logger"===S.type&&j(o,S.type)}if(l&&"todo"===l.type){let E=e.target.closest(".todo-item");if(E){let L=parseInt(E.dataset.index);e.target.closest(".delete-todo-item")?l.content.splice(L,1):e.target.classList.contains("todo-checkbox")&&(l.content[L].completed=!l.content[L].completed),s.save("customCards"),I.todo.render(t,l)}}if(e.target.closest(".toggle-daily-task")){let C=e.target.closest(".toggle-daily-task"),T=parseInt(C.dataset.index),B=e.target.closest(".card"),M=B.dataset.cardId,D=s.customCards.find(e=>e.id===M),A=B.querySelector(".daily-date-selector").value;D&&D.content[A]&&(D.content[A][T].completed=!D.content[A][T].completed,s.save("customCards"),I["daily-tasks"].render(B,D))}if(e.target.closest(".delete-daily-task")){let P=e.target.closest(".delete-daily-task"),R=parseInt(P.dataset.index),N=e.target.closest(".card"),U=N.dataset.cardId,F=s.customCards.find(e=>e.id===U),G=N.querySelector(".daily-date-selector").value;F&&F.content[G]&&(F.content[G].splice(R,1),0===F.content[G].length&&delete F.content[G],s.save("customCards"),I["daily-tasks"].render(N,F))}if(e.target.closest(".prev-day-btn")||e.target.closest(".next-day-btn")){let z=t.querySelector(".daily-date-selector"),O=new Date(z.value||new Date),Y=e.target.closest(".prev-day-btn")?-1:1;O.setDate(O.getDate()+Y);let J=O.toISOString().split("T")[0];z.value=J,t.dataset.selectedDate=J;let W=s.customCards.find(e=>e.id===o);I["daily-tasks"].render(t,W)}let V=s.customCards.find(e=>e.id===o);if(V&&"daily-tasks"===V.type){let Z=t.querySelector(".daily-date-selector").value;V.content[Z]||(V.content[Z]=[]);let K=V.content[Z],X=e.target.closest("li");if(X){let Q=parseInt(X.dataset.index),ee=K[Q];if(ee){if(e.target.closest(".status-btn")){let et=["todo","in-progress","done"],eo=et.indexOf(ee.status||"todo");ee.status=et[(eo+1)%3],ee.completed="done"===ee.status,s.save("customCards"),I["daily-tasks"].render(t,V)}else if(e.target.closest(".priority-btn")){let es=["medium","high","low"],ea=es.indexOf(ee.priority||"medium");ee.priority=es[(ea+1)%3],s.save("customCards"),I["daily-tasks"].render(t,V)}else if(e.target.closest(".toggle-expand-btn"))ee.expanded=!ee.expanded,s.save("customCards"),I["daily-tasks"].render(t,V);else if(e.target.closest(".toggle-subtask-btn")){let er=parseInt(e.target.closest(".toggle-subtask-btn").dataset.subIndex);ee.subtasks[er]&&(ee.subtasks[er].completed=!ee.subtasks[er].completed,s.save("customCards"),I["daily-tasks"].render(t,V))}else if(e.target.closest(".delete-subtask-btn")){let en=parseInt(e.target.closest(".delete-subtask-btn").dataset.subIndex);ee.subtasks.splice(en,1),s.save("customCards"),I["daily-tasks"].render(t,V)}else e.target.closest(".delete-daily-task")&&(K.splice(Q,1),0===K.length&&delete V.content[Z],s.save("customCards"),I["daily-tasks"].render(t,V))}}}if(l&&"line-graph"===l.type&&e.target.closest(".delete-mark-item")){let ei=parseInt(e.target.closest(".delete-mark-item").dataset.index);l.content.splice(ei,1),s.save("customCards"),I["line-graph"].render(t,l)}if(e.target.closest(".toggle-manual-form")){let el=e.target.closest(".card").querySelector(".manual-log-form");el.classList.toggle("hidden");let ed=e.target.closest(".toggle-manual-form").querySelector("span");el.classList.contains("hidden")?ed.textContent="+ Add Manual Entry":ed.textContent="- Close"}l&&"pomodoro"===l.type&&(e.target.classList.contains("pomodoro-btn")?H.setMode(o,e.target.dataset.mode):e.target.classList.contains("start-pause-btn")?H.toggle(o):e.target.classList.contains("reset-btn")&&H.reset(o)),l&&"time-logger"===l.type&&(e.target.classList.contains("start-pause-btn")?window.timeLogger.toggle(o):e.target.classList.contains("log-btn")?window.timeLogger.log(o):e.target.classList.contains("reset-btn")&&window.timeLogger.reset(o))}),i.dashboardGrid.addEventListener("change",e=>{if(e.target.classList.contains("pomodoro-duration-input")){let t=e.target.closest(".card").dataset.cardId,o=e.target.dataset.mode,a=parseInt(e.target.value);a<1&&(a=1,e.target.value=1),t&&o&&!isNaN(a)&&H.setDuration(t,o,a)}if(e.target.classList.contains("subject-select")){let r=e.target.closest(".card").dataset.cardId;window.timeLogger.changeSubject(r,e.target.value)}if(e.target.classList.contains("daily-date-selector")){let n=e.target.closest(".card"),i=n.dataset.cardId,l=s.customCards.find(e=>e.id===i);n.dataset.selectedDate=e.target.value,I["daily-tasks"].render(n,l)}}),i.dashboardGrid.addEventListener("submit",e=>{e.preventDefault();let t=e.target,o=t.closest(".card"),a=o.dataset.cardId;if("add-test-form"===t.id){let{date:r,name:n}=t.elements;if(r.value&&n.value.trim()){let l=r.value,d=n.value.trim();s.tests[l]?s.tests[l]=s.tests[l]+" | "+d:s.tests[l]=d,s.save("tests"),q(),t.reset()}}else if(t.classList.contains("add-todo-form")){let c=s.customCards.find(e=>e.id===a),u=t.querySelector("input"),m=u.value.trim();if("coco"===m.toLowerCase()){N||(N={theme:s.settings.theme,customCards:JSON.parse(JSON.stringify(s.customCards)),tests:JSON.parse(JSON.stringify(s.tests)),layout:[...s.layout]}),i.godModePanel.classList.remove("hidden"),new Tone.Synth().toDestination().triggerAttackRelease("C4","0.5"),u.value="";return}if("doingocmakesmeexcited"===m.toLowerCase()){s.settings.theme="chaitanya-noob",s.saveSettings(),M(),q(),u.value="";return}c&&m&&(Array.isArray(c.content)||(c.content=[]),c.content.push({text:m,completed:!1}),s.save("customCards"),I.todo.render(o,c),u.value="")}else if(t.classList.contains("manual-log-form")){let g=t.querySelector(".manual-subject-select").value,p=t.querySelector('input[name="minutes"]'),h=parseInt(p.value);if(g&&h>0){let y=_(new Date);s.studyLogs[y]||(s.studyLogs[y]={});let $=60*h;s.studyLogs[y][g]=(s.studyLogs[y][g]||0)+$,s.save("studyLogs"),q(),p.value="",console.log(`Added ${h} mins to ${g}`)}}else if(t.classList.contains("add-daily-task-form")){let b=s.customCards.find(e=>e.id===a),f=t.querySelector("input"),v=f.value.trim(),x=o.querySelector(".daily-date-selector"),k=x.value;b&&v&&k&&((!b.content||Array.isArray(b.content))&&(b.content={}),b.content[k]||(b.content[k]=[]),b.content[k].push({text:v,completed:!1}),s.save("customCards"),I["daily-tasks"].render(o,b),f.value="")}else if(t.classList.contains("add-subtask-form")){let w=s.customCards.find(e=>e.id===a),S=t.closest("li"),E=parseInt(S.dataset.index),L=t.querySelector("input"),C=L.value.trim();if(w&&C){if("daily-tasks"===w.type){let T=o.querySelector(".daily-date-selector").value,B=w.content[T]?.[E];if(B){B.subtasks||(B.subtasks=[]),B.subtasks.push({text:C,completed:!1}),s.save("customCards"),I["daily-tasks"].render(o,w);let j=o.querySelector(`li[data-index="${E}"]`);j&&j.querySelector("input").focus()}}else{let D=w.content[E];if(D){D.subtasks||(D.subtasks=[]),D.subtasks.push({text:C,completed:!1}),s.save("customCards"),I.todo.render(o,w);let A=o.querySelector(`li[data-index="${E}"]`);if(A){let P=A.querySelector(".add-subtask-form input");P&&P.focus()}}}}}else if(t.classList.contains("add-marks-form")){let R=s.customCards.find(e=>e.id===a),{name:H,phy:U,chem:F,math:G,maxMarks:z}=t.elements;if(R&&H.value.trim()&&U.value&&F.value&&G.value&&z.value){Array.isArray(R.content)||(R.content=[]);let O=parseFloat(U.value),Y=parseFloat(F.value),J=parseFloat(G.value),W=O+Y+J;R.content.push({name:H.value.trim(),maxMarks:parseFloat(z.value),total:W,subjects:{physics:O,chemistry:Y,maths:J}}),s.save("customCards"),I["line-graph"].render(o,R),t.reset()}}else if(t.classList.contains("update-youtube-form")){let V=s.customCards.find(e=>e.id===a),Z=t.querySelector("input");V&&Z.value.trim()&&(V.content=Z.value.trim(),s.save("customCards"),I.youtube.render(o,V))}}),i.buttons.addCard.forEach(e=>e.addEventListener("click",()=>i.modals.addCard.classList.remove("hidden"))),i.buttons.cancelAddCard.addEventListener("click",()=>i.modals.addCard.classList.add("hidden")),i.inputs.cardType.addEventListener("change",e=>{let t="note"===e.target.value,o="youtube"===e.target.value;i.inputs.cardContent.style.display=t||o?"block":"none",i.inputs.cardContent.placeholder=o?"Paste YouTube video URL...":"Card Content (for notes)"}),i.forms.newCard.addEventListener("submit",e=>{e.preventDefault();let t=i.inputs.cardType.value,o=i.forms.newCard.querySelector('input[type="text"]').value.trim();if(!o)return;let a={id:`custom-${Date.now()}`,type:t,title:o,content:"note"===t||"youtube"===t?i.inputs.cardContent.value.trim():[]};s.customCards.push(a);let r={colspan:"line-graph"===t||"youtube"===t||"time-logger"===t||"analytics"===t?2:1};"line-graph"===t&&(r.maxMarks=300),s.cardProps[a.id]=r,s.save("customCards"),s.save("cardProps"),q(),i.modals.addCard.classList.add("hidden"),i.forms.newCard.reset(),i.inputs.cardContent.style.display="block"});let D=()=>i.modals.customize.classList.add("hidden");i.buttons.customize.forEach(e=>e.addEventListener("click",()=>i.modals.customize.classList.remove("hidden"))),i.buttons.closeCustomize.addEventListener("click",D),i.buttons.closeCustomizeIcon.addEventListener("click",D),i.modals.customize.addEventListener("click",e=>{e.target===i.modals.customize&&D()});let A=document.getElementById("preset-wallpaper-grid"),P=[{name:"Deep Space",type:"img",thumb:"https://images.unsplash.com/photo-1462331940025-496dfbfc7564?auto=format&fit=crop&w=200&q=60",url:"https://images.unsplash.com/photo-1462331940025-496dfbfc7564?auto=format&fit=crop&w=1920&q=80"},{name:"Midnight City",type:"img",thumb:"https://images.unsplash.com/photo-1519501025264-65ba15a82390?auto=format&fit=crop&w=200&q=60",url:"https://images.unsplash.com/photo-1519501025264-65ba15a82390?auto=format&fit=crop&w=1920&q=80"},{name:"Dark Library",type:"img",thumb:"https://images.unsplash.com/photo-1507842217343-583bb7270b66?auto=format&fit=crop&w=200&q=60",url:"https://images.unsplash.com/photo-1507842217343-583bb7270b66?auto=format&fit=crop&w=1920&q=80"},{name:"Zen Forest",type:"img",thumb:"https://images.pexels.com/photos/167699/pexels-photo-167699.jpeg?auto=compress&cs=tinysrgb&w=200",url:"https://images.pexels.com/photos/167699/pexels-photo-167699.jpeg?auto=compress&cs=tinysrgb&w=1920"},{name:"Study Desk",type:"img",thumb:"https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?auto=format&fit=crop&w=200&q=60",url:"https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?auto=format&fit=crop&w=1920&q=80"},{name:"Stormy Sea",type:"img",thumb:"https://images.unsplash.com/photo-1505118380757-91f5f5632de0?auto=format&fit=crop&w=200&q=60",url:"https://images.unsplash.com/photo-1505118380757-91f5f5632de0?auto=format&fit=crop&w=1920&q=80"},{name:"Minimal Dark",type:"img",thumb:"https://images.unsplash.com/photo-1478760329108-5c3ed9d495a0?auto=format&fit=crop&w=200&q=60",url:"https://images.unsplash.com/photo-1478760329108-5c3ed9d495a0?auto=format&fit=crop&w=1920&q=80"},{name:"Cozy Rain",type:"img",thumb:"https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?auto=format&fit=crop&w=200&q=60",url:"https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?auto=format&fit=crop&w=1920&q=80"}];A&&P.forEach(e=>{let t=document.createElement("button");t.className="relative group w-full h-16 rounded-md overflow-hidden border border-gray-700 hover:border-white transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500",t.type="button",t.innerHTML=`

                <img src="${e.thumb}" alt="${e.name}" class="w-full h-full object-cover opacity-70 group-hover:opacity-100 transition-opacity">

                <span class="absolute bottom-0 left-0 right-0 bg-black/60 text-[9px] text-white text-center py-0.5 truncate">${e.name}</span>

                ${"gif"===e.type?'<span class="absolute top-1 right-1 bg-indigo-600/80 text-[8px] text-white px-1 rounded">GIF</span>':""}

            `,t.addEventListener("click",()=>{i.inputs.bgUrl.value=e.url,s.settings.bgUrl=e.url,R()}),A.appendChild(t)});let R=()=>{s.saveSettings(),M(),q()};i.inputs.examType.addEventListener("change",()=>{s.settings.examType=i.inputs.examType.value,R()}),i.inputs.examYear.addEventListener("change",()=>{s.settings.examYear=i.inputs.examYear.value,s.settings.jeeShiftDate="",i.inputs.jeeShift.value="",R()}),i.inputs.theme.addEventListener("change",()=>{s.settings.theme=i.inputs.theme.value,s.saveSettings(),M(),q()}),i.inputs.font.addEventListener("change",()=>{s.settings.font=i.inputs.font.value,s.saveSettings(),M()}),i.inputs.bgUrl.addEventListener("input",()=>{s.settings.bgUrl=i.inputs.bgUrl.value,s.saveSettings(),M()}),i.buttons.removeBg.addEventListener("click",()=>{s.settings.bgUrl="",s.saveSettings(),M()}),i.inputs.youtubeTintToggle.addEventListener("change",()=>{s.settings.youtubeTintEnabled=i.inputs.youtubeTintToggle.checked,s.saveSettings(),B()}),i.inputs.youtubeBlurToggle.addEventListener("change",()=>{s.settings.youtubeBlurEnabled=i.inputs.youtubeBlurToggle.checked,s.saveSettings(),B()}),i.inputs.focusShieldToggle.addEventListener("change",()=>{let e=i.inputs.focusShieldToggle.checked;if(s.settings.focusShieldEnabled=e,s.saveSettings(),!e&&s.activeTimer.cardId){let{cardId:t,type:o}=s.activeTimer;"pomodoro"===o&&H.stop(t),"time-logger"===o&&window.timeLogger.pause(t)}}),i.inputs.tickingSoundToggle.addEventListener("change",()=>{s.settings.tickingSoundEnabled=i.inputs.tickingSoundToggle.checked,s.saveSettings()}),i.inputs.ricedModeToggle.addEventListener("change",()=>{s.settings.ricedModeEnabled=i.inputs.ricedModeToggle.checked,s.saveSettings(),M()}),i.buttons.resetDashboard.addEventListener("click",()=>{x("This will delete all custom cards and reset the layout to the default.",async()=>{if(Object.keys(e).forEach(t=>{"settings"!==t&&"mobileAlertDismissed"!==t&&localStorage.removeItem(e[t])}),currentUser){b("Resetting Cloud Data...");try{await db.collection("users").doc(currentUser.uid).delete(),console.log("Cloud data deleted.")}catch(t){console.error("Error resetting cloud data:",t),alert("Failed to reset cloud data. Check console.");return}}location.reload()},"Reset Dashboard?")}),i.buttons.exportData.addEventListener("click",()=>{let t={};for(let o in e){let s=localStorage.getItem(e[o]);null!==s&&(t[o]=JSON.parse(s))}let a=JSON.stringify(t,null,2),r=new Blob([a],{type:"application/json"}),n=URL.createObjectURL(r),i=document.createElement("a");i.href=n;let l=new Date().toISOString().slice(0,10);i.download=`studylocus-backup-${l}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}),i.buttons.importData.addEventListener("click",()=>{i.inputs.importFile.click()}),i.inputs.importFile.addEventListener("change",t=>{let o=t.target.files[0];if(!o)return;let a=new FileReader;a.onload=t=>{try{let o=JSON.parse(t.target.result);if(!o.layout||!o.customCards){alert("Invalid backup file.");return}x("This will overwrite your dashboard.",()=>{for(let t in e)o[t]&&(s[t]=o[t],localStorage.setItem(e[t],JSON.stringify(o[t])));k(),currentUser&&h(),M(),q(),b("Import Successful")},"Import Data?")}catch(a){console.error(a),alert("Error reading file.")}finally{i.inputs.importFile.value=""}},a.readAsText(o)}),i.inputs.streamlinedModeToggle&&i.inputs.streamlinedModeToggle.addEventListener("change",()=>{s.settings.streamlinedModeEnabled=i.inputs.streamlinedModeToggle.checked,s.saveSettings(),M(),q()}),i.buttons.info.forEach(e=>e.addEventListener("click",()=>i.modals.info.classList.remove("hidden"))),i.buttons.closeInfo.addEventListener("click",()=>i.modals.info.classList.add("hidden")),i.buttons.zenModeBtn.forEach(e=>e.addEventListener("click",()=>{i.body.classList.add("zen-mode"),i.buttons.exitZenBtn.classList.remove("hidden")})),i.buttons.exitZenBtn.addEventListener("click",()=>{i.body.classList.remove("zen-mode"),i.buttons.exitZenBtn.classList.add("hidden")}),i.buttons.confirmCancel.addEventListener("click",()=>{i.modals.confirm.classList.add("hidden"),f=null}),i.buttons.confirmOk.addEventListener("click",()=>{"function"==typeof f&&f(),i.modals.confirm.classList.add("hidden"),f=null});let H={tick(e){let t=s.pomodoroState[e];t.time>0?(t.time--,this.updateDisplay(e)):(this.stop(e),new Tone.Synth().toDestination().triggerAttackRelease("C5","0.5"))},updateDisplay(e){let t=i.dashboardGrid.querySelector(`[data-card-id="${e}"]`);t&&I.pomodoro.render(t,{id:e});let o=s.pomodoroState[e];if(o.isRunning){let a=Math.floor(o.time/60).toString().padStart(2,"0"),r=(o.time%60).toString().padStart(2,"0");document.title=`${a}:${r} - Time to focus!`}else{let{examType:n,examYear:l}=s.settings;document.title=`${n} ${l} | StudyLocus`}},start(e,t=!1){let o=s.pomodoroState[e];if(!o.isRunning){if(o.isRunning=!0,!t){if(s.activeTimer.cardId!==e||"pomodoro"!==s.activeTimer.type){s.activeTimer.unfocusedTime=0;let a=i.dashboardGrid.querySelector(`[data-card-id="${e}"]`);if(a){let r=a.querySelector(".focus-status");r&&(r.textContent="")}}s.activeTimer.cardId=e,s.activeTimer.type="pomodoro",s.settings.focusShieldEnabled&&U()}o.intervalId=setInterval(()=>this.tick(e),1e3),this.updateDisplay(e),s.save("pomodoroState")}},_internalPause(e){let t=s.pomodoroState[e];clearInterval(t.intervalId),t.isRunning=!1,this.updateDisplay(e)},stop(e){let t=s.pomodoroState[e];clearInterval(t.intervalId),s.activeTimer.cardId===e&&(s.activeTimer.cardId=null,s.activeTimer.type=null,s.settings.focusShieldEnabled&&F()),t.isRunning=!1,this.updateDisplay(e),s.save("pomodoroState")},toggle(e){s.pomodoroState[e].isRunning?this.stop(e):this.start(e)},reset(e){let t=s.pomodoroState[e];this.stop(e),t.time=60*t.durations[t.mode],this.updateDisplay(e),s.save("pomodoroState")},setMode(e,t){s.pomodoroState[e].mode=t,this.reset(e)},setDuration(e,t,o){let a=s.pomodoroState[e];a.durations[t]=o,a.mode===t&&this.reset(e),s.save("pomodoroState")}};window.timeLogger={tick(e){let t=s.timeLoggerState[e];if(t&&t.isRunning&&t.startTime){let o=Date.now()-t.startTime,a=t.accumulatedTime+Math.round(o/1e3),r=i.dashboardGrid.querySelector(`[data-card-id="${e}"]`),n=S(a);r&&(r.querySelector(".timer-display").textContent=n,C()),document.title=`${n} â€¢ ${t.currentSubject||"Focus"}`}},start(e){let t=s.timeLoggerState[e];if(!t||t.isRunning)return;t.isRunning=!0,t.startTime=Date.now(),s.activeTimer.cardId=e,s.activeTimer.type="time-logger",s.settings.focusShieldEnabled&&U(),t.intervalId=setInterval(()=>this.tick(e),1e3);let o=i.dashboardGrid.querySelector(`[data-card-id="${e}"]`);o&&(o.querySelector(".start-pause-btn").textContent="PAUSE"),s.save("timeLoggerState"),T()},pause(e,t=!0){let o=s.timeLoggerState[e];if(!o||!o.isRunning)return;clearInterval(o.intervalId);let a=Date.now()-o.startTime;o.accumulatedTime+=Math.round(a/1e3),o.isRunning=!1,o.startTime=null,o.intervalId=null,s.activeTimer.cardId===e&&(s.activeTimer.cardId=null,s.activeTimer.type=null,s.settings.focusShieldEnabled&&F());let{examType:r,examYear:n}=s.settings,l="Custom"===r?s.settings.customExamName||"My Exam":`${r} ${n}`;if(document.title=`${l} | StudyLocus`,s.save("timeLoggerState"),t){let d=i.dashboardGrid.querySelector(`[data-card-id="${e}"]`);d&&I["time-logger"].render(d,{id:e})}T(),C()},toggle(e){s.timeLoggerState[e].isRunning?this.pause(e):this.start(e)},log(e){this.pause(e,!1);let t=s.timeLoggerState[e];if(t.accumulatedTime<60){let o=i.dashboardGrid.querySelector(`[data-card-id="${e}"]`);if(o){let a=o.querySelector(".log-message");a&&(a.textContent="Minimum log time is 1 minute.",setTimeout(()=>{a&&(a.textContent="")},3e3))}this.start(e);return}let r=_(new Date);s.studyLogs[r]||(s.studyLogs[r]={});let n=t.currentSubject;s.studyLogs[r][n]=(s.studyLogs[r][n]||0)+t.accumulatedTime,s.save("studyLogs"),t.accumulatedTime=0,s.save("timeLoggerState"),q(),C(),T()},reset(e){this.pause(e,!1),s.timeLoggerState[e].accumulatedTime=0,s.save("timeLoggerState"),q(),C(),T()},changeSubject(e,t){let o=s.timeLoggerState[e],a=i.dashboardGrid.querySelector(`[data-card-id="${e}"]`);if("add_new"===t){let r=prompt("Enter new subject name:");r&&r.trim()?(s.settings.userSubjects||(s.settings.userSubjects=[]),s.settings.userSubjects.push(r.trim()),s.saveSettings(),o.currentSubject=r.trim(),q()):a&&(a.querySelector(".subject-select").value=o.currentSubject)}else o&&(o.currentSubject=t,s.save("timeLoggerState"))}},i.inputs.examType.addEventListener("change",()=>{s.settings.examType=i.inputs.examType.value,"JEE"===s.settings.examType?i.inputs.jeeContainer.classList.remove("hidden"):i.inputs.jeeContainer.classList.add("hidden"),R()}),i.inputs.jeeSession.addEventListener("change",()=>{s.settings.jeeSession=i.inputs.jeeSession.value,s.settings.jeeShiftDate="",i.inputs.jeeShift.value="",R();let{examType:e,examYear:t,jeeSession:o}=s.settings,a="JEE"===e?`JEE ${t}`:`${e} ${t}`;i.mainTitle.textContent=a}),i.inputs.jeeShift.addEventListener("change",()=>{s.settings.jeeShiftDate=i.inputs.jeeShift.value,R()});let N=null;function U(){try{document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen()}catch(e){console.warn("Fullscreen request failed.",e)}document.addEventListener("visibilitychange",z),document.addEventListener("fullscreenchange",G)}function F(){try{document.fullscreenElement&&document.exitFullscreen&&document.exitFullscreen()}catch(e){console.warn("Exit fullscreen request failed.",e)}document.removeEventListener("visibilitychange",z),document.removeEventListener("fullscreenchange",G);let{cardId:t,type:o}=s.activeTimer,a=i.dashboardGrid.querySelector(`[data-card-id="${t}"]`);if(a){let r=a.querySelector(".focus-status");r&&(r.textContent="")}}function G(){if(!document.fullscreenElement&&s.activeTimer.cardId){let{cardId:e,type:t}=s.activeTimer;"pomodoro"===t&&H.stop(e),"time-logger"===t&&window.timeLogger.pause(e)}}function z(){let{cardId:e,type:t}=s.activeTimer;if(!e||"time-logger"!==t)return;let o=window.timeLogger,a=s.timeLoggerState[e];if(a){if("hidden"===document.visibilityState)a.isRunning&&o.pause(e,!1);else if("visible"===document.visibilityState&&a.isRunning){let r=(Date.now()-a.startTime)/1e3;a.accumulatedTime+=Math.round(r),o.start(e)}}}i.body.addEventListener("click",e=>{if(e.target.closest("#god-mode-panel")){let t=e.target.id;if("god-mode-close-btn"===t&&(i.godModePanel.classList.add("hidden"),N&&(s.settings.theme=N.theme,s.customCards=N.customCards,s.tests=N.tests,s.layout=N.layout,N=null,M(),q())),"god-mode-theme-btn"===t){let o=i.inputs.theme;if(!o.querySelector('[value="god-mode"]')){let a=document.createElement("option");a.value="god-mode",a.textContent="--- GOD MODE ---",o.appendChild(a)}s.settings.theme="god-mode",M(),q()}if("god-mode-complete-tasks-btn"===t&&(s.customCards.forEach(e=>{"todo"===e.type&&Array.isArray(e.content)&&e.content.forEach(e=>e.completed=!0)}),q()),"god-mode-perfect-score-btn"===t){let r=s.customCards.find(e=>"line-graph"===e.type);if(r&&Array.isArray(r.content)){let n="NEET"===s.settings.examType?720:300;r.content.push({name:"God Tier",marks:n,maxMarks:n}),q()}}if("god-mode-timewarp-btn"===t){let l={};Object.keys(s.tests).forEach(e=>{let t=new Date(e+"T00:00:00");t.setDate(t.getDate()+7);let o=_(t);l[o]=s.tests[e]}),s.tests=l,q()}if("god-mode-scramble-btn"===t){let d=s.layout;for(let c=d.length-1;c>0;c--){let u=Math.floor(Math.random()*(c+1));[d[c],d[u]]=[d[u],d[c]]}q()}"god-mode-nuke-btn"===t&&(i.dashboardGrid.querySelectorAll(".card").forEach((e,t)=>{e.style.animation=`fall-apart 1s ease-in-out ${.05*t}s forwards`}),setTimeout(()=>{x("Dashboard nuked. Restore?",()=>{i.dashboardGrid.innerHTML="",q()},"KABOOM!")},1500))}}),i.inputs.customName.addEventListener("input",()=>{s.settings.customExamName=i.inputs.customName.value,R()}),i.inputs.customDate.addEventListener("change",()=>{s.settings.customExamDate=i.inputs.customDate.value,R()}),i.inputs.examType.addEventListener("change",()=>{s.settings.examType=i.inputs.examType.value,i.inputs.jeeContainer.classList.toggle("hidden","JEE"!==s.settings.examType),i.inputs.customContainer.classList.toggle("hidden","Custom"!==s.settings.examType),R()}),i.mainTitle.addEventListener("click",e=>{3===e.detail&&(clearTimeout(null),i.inputs.theme.querySelector('[value="alakh-pandey"]').classList.remove("hidden"),s.settings.theme="alakh-pandey",s.saveSettings(),M(),q())});let O=!1;document.addEventListener("click",()=>{O||"undefined"==typeof Tone||"suspended"!==Tone.context.state||(Tone.start(),O=!0,console.log("AudioContext resumed by user gesture."));let e=document.getElementById("user-menu-dropdown");e&&!e.classList.contains("hidden")&&e.classList.add("hidden")}),p(),M(),q(),new Sortable(i.dashboardGrid,{animation:150,handle:".drag-handle",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",onEnd(){s.layout=[...i.dashboardGrid.children].map(e=>e.dataset.cardId),s.save("layout")}});let Y=new Tone.NoiseSynth({noise:{type:"white"},envelope:{attack:.001,decay:.005,sustain:0}}).toDestination(),J=new Tone.NoiseSynth({noise:{type:"pink"},envelope:{attack:.001,decay:.015,sustain:0}}).toDestination(),W=new Tone.Filter(4e3,"highpass").toDestination();Y.connect(W),J.connect(W);let V=0,Z=0,K=!1;setInterval(()=>{let e=i.dashboardGrid.querySelector('[data-card-id="countdown"]');if(e&&I.countdown.render&&I.countdown.render(e),s.settings.tickingSoundEnabled?++V>=60&&(K?J.triggerAttackRelease("32n",void 0,.1):Y.triggerAttackRelease("32n",void 0,.15),e&&(e.style.transform="scale(1.04)",e.style.transition="transform 0.1s ease-out",setTimeout(()=>{e.style.transform="scale(1)"},100)),K=!K,V=0):V=0,++Z>=30){let t=i.dashboardGrid.querySelector('[data-card-id="quote"]');if(t&&I.quote.render){let o=t.querySelector("#quote-card-content");o?(o.style.transition="opacity 0.5s ease",o.style.opacity="0",setTimeout(()=>{I.quote.render(t),o.style.opacity="1"},500)):I.quote.render(t)}Z=0}let a=i.dashboardGrid.querySelector('[data-card-id="time"]');a&&I.time.render&&I.time.render(a)},1e3),window.addEventListener("beforeunload",()=>{s.activeTimer.cardId&&"time-logger"===s.activeTimer.type&&(console.log("Unload event: Forcing final save for active study logger."),window.timeLogger.pause(s.activeTimer.cardId,!1))});let X=document.getElementById("info-modal"),Q=X.querySelectorAll(".tab-btn"),ee=X.querySelectorAll(".tab-content");X.addEventListener("click",e=>{let t=e.target.closest(".tab-btn");if(!t)return;let o=t.dataset.tab;Q.forEach(e=>{e.classList.toggle("active",e.dataset.tab===o)}),ee.forEach(e=>{e.classList.toggle("hidden",e.id!==`tab-${o}`)})});let et=document.getElementById("super-focus-overlay"),eo=document.querySelectorAll(".focus-tab-btn"),es=document.querySelectorAll(".focus-view"),ea=document.getElementById("toggle-focus-fullscreen"),er=document.getElementById("focus-clock-display"),en=document.getElementById("focus-date-display"),ei=document.getElementById("focus-quote-display"),el=document.getElementById("focus-big-timer"),ed=document.getElementById("focus-timer-toggle"),ec=document.getElementById("focus-timer-reset"),eu=document.getElementById("dashboard-timer-display"),em=document.getElementById("dash-timer-toggle"),eg=document.getElementById("dash-timer-reset"),ep=document.querySelectorAll(".timer-mode-btn"),eh=document.getElementById("focus-dashboard-tasks"),ey=document.getElementById("focus-dash-add-task"),e$="pomodoro",eb=null,ef=0,ev=()=>{i.body.style.backgroundImage&&(et.style.backgroundImage=i.body.style.backgroundImage),et.classList.remove("hidden"),e_("clock"),eE(!0),eL(),eC()};function ex(){let e=!1;if(!s.customCards.some(e=>"pomodoro"===e.type)){let t={id:`custom-${Date.now()}-pom`,type:"pomodoro",title:"Pomodoro",content:[]};s.customCards.push(t),s.layout.push(t.id),s.pomodoroState[t.id]={mode:"pomodoro",time:1500,isRunning:!1,durations:{pomodoro:25,shortBreak:5,longBreak:15}},e=!0}if(!s.customCards.some(e=>"time-logger"===e.type)){let o={id:`custom-${Date.now()}-log`,type:"time-logger",title:"Study Logger",content:[]};s.customCards.push(o),s.layout.push(o.id),s.timeLoggerState[o.id]={isRunning:!1,accumulatedTime:0,currentSubject:"Physics"},e=!0}e&&(s.save("customCards"),s.save("layout"),s.save("pomodoroState"),s.save("timeLoggerState"),q(),console.log("Auto-added missing timer cards for Focus Mode."))}function e_(e){eo.forEach(t=>t.classList.toggle("active",t.dataset.view===e)),es.forEach(e=>e.classList.add("hidden")),document.getElementById(`focus-view-${e}`).classList.remove("hidden")}function e0(e){e$=e,ep.forEach(t=>t.classList.toggle("active",t.dataset.mode===e)),ek()}function ek(){let e="00:00",t=!1,o=null;if("pomodoro"===e$){let a=s.customCards.find(e=>"pomodoro"===e.type);if(a){o=a.id;let r=s.pomodoroState[o];if(r){let n=Math.floor(r.time/60).toString().padStart(2,"0"),i=(r.time%60).toString().padStart(2,"0");e=`${n}:${i}`,t=r.isRunning}}}else{let l=s.customCards.find(e=>"time-logger"===e.type);if(l){o=l.id;let d=s.timeLoggerState[o];if(d){let c=d.accumulatedTime;if(d.isRunning&&d.startTime){let u=Math.round((Date.now()-d.startTime)/1e3);c+=u}e=S(c),t=d.isRunning}}}el&&(el.textContent=e),eu&&(eu.textContent=e);let m=t?"PAUSE":"START",g=t?"#2C2D33":"grey";[ed,em].forEach(e=>{e&&(e.textContent=m,e.style.backgroundColor=g,e.onclick=()=>ew(o,e$))}),[ec,eg].forEach(e=>{e&&(e.onclick=()=>eS(o,e$))})}function ew(e,t){e&&("pomodoro"===t?H.toggle(e):window.timeLogger.toggle(e),setTimeout(ek,50))}function eS(e,t){e&&("pomodoro"===t?H.reset(e):window.timeLogger.reset(e),setTimeout(ek,50))}function eE(e=!1){if(!ei)return;let t="alakh-pandey"===s.settings.theme?r:a,o=t[Math.floor(Math.random()*t.length)];e?(ei.textContent=`"${o.text}"`,ei.style.opacity=1):(ei.style.opacity=0,setTimeout(()=>{ei.textContent=`"${o.text}"`,ei.style.opacity=1},800))}function eL(){eb&&clearInterval(eb),ef=0,eb=setInterval(()=>{let e=new Date;er&&(er.textContent=e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})),en&&(en.textContent=e.toLocaleDateString([],{weekday:"long",month:"long",day:"numeric"})),et.classList.contains("hidden")||ek(),++ef>=10&&(eE(),ef=0)},1e3),ek()}function eC(){if(!eh)return;eh.innerHTML="";let e=s.customCards.find(e=>"todo"===e.type);e||(e={id:`custom-${Date.now()}-todo`,type:"todo",title:"Tasks",content:[]},s.customCards.push(e),s.layout.push(e.id),s.save("customCards"),s.save("layout"),q()),e&&e.content&&e.content.forEach(e=>{if(!e.completed){let t=document.createElement("li");t.className="flex items-center gap-3 p-3 bg-white/5 rounded-lg hover:bg-white/10 cursor-pointer group transition-all",t.innerHTML=`

                    <div class="w-4 h-4 rounded-full border border-white/40 group-hover:border-green-400 group-hover:bg-green-400/20 transition-colors"></div>

                    <span class="text-sm text-white/80 group-hover:text-white transition-colors">${e.text}</span>

                `,t.addEventListener("click",()=>{e.completed=!0,s.save("customCards"),t.style.opacity="0",setTimeout(eC,200)}),eh.appendChild(t)}})}document.getElementById("exit-super-focus").addEventListener("click",()=>{et.classList.add("hidden"),eb&&clearInterval(eb),document.fullscreenElement&&document.exitFullscreen().catch(e=>console.log(e)),q()}),ea.addEventListener("click",()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen().catch(e=>console.log(e)):document.documentElement.requestFullscreen().catch(e=>console.log(e))}),eo.forEach(e=>{e.addEventListener("click",()=>{let t=e.dataset.view;if(("timer"===t||"dashboard"===t)&&(ex(),"timer"===t)){let o=s.customCards.some(e=>"pomodoro"===e.type),a=s.customCards.some(e=>"time-logger"===e.type);o||"pomodoro"!==e$||e0("logger"),a||"logger"!==e$||e0("pomodoro")}e_(t)})}),ep.forEach(e=>{e.addEventListener("click",()=>{let t=e.dataset.mode;ex(),e0(t)})}),ey&&ey.addEventListener("keypress",e=>{if("Enter"===e.key&&e.target.value.trim()){let t=s.customCards.find(e=>"todo"===e.type);t||(t={id:`custom-${Date.now()}`,type:"todo",title:"Tasks",content:[]},s.customCards.push(t)),t.content.push({text:e.target.value.trim(),completed:!1}),s.save("customCards"),eC(),e.target.value=""}});let e3=document.querySelector(".default-header .flex.items-center.space-x-2"),eT=document.getElementById("open-focus-mode-btn");if(eT&&eT.remove(),e3){let e2=document.createElement("button");e2.id="open-focus-mode-btn",e2.className="bg-gray-700/50 hover:bg-gray-600/60 text-white font-bold p-2 rounded-full transition-colors text-sm",e2.title="Super Focus Mode",e2.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>',e2.addEventListener("click",ev);let eI=document.getElementById("zen-mode-btn");e3.insertBefore(e2,eI)}let e4=document.getElementById("shortcuts-modal"),e1=document.getElementById("close-shortcuts-modal");e1&&e1.addEventListener("click",()=>{e4.classList.add("hidden")}),document.addEventListener("keydown",e=>{let t=document.activeElement.tagName,o="INPUT"===t||"TEXTAREA"===t||"SELECT"===t||document.activeElement.isContentEditable;if("Escape"===e.key){if(o){document.activeElement.blur();return}Object.values(i.modals).forEach(e=>e.classList.add("hidden")),e4&&e4.classList.add("hidden"),document.getElementById("mobile-alert")&&document.getElementById("mobile-alert").classList.add("hidden");return}if(o)return;let a=e.key.toLowerCase();switch(a){case" ":e.preventDefault();let r=s.activeTimer.cardId,n=s.activeTimer.type;if(!r){let l=s.customCards.find(e=>"pomodoro"===e.type);l&&(r=l.id,n="pomodoro")}r&&n&&("pomodoro"===n&&H.toggle(r),"time-logger"===n&&window.timeLogger.toggle(r));break;case"z":i.body.classList.toggle("zen-mode");let d=i.body.classList.contains("zen-mode");i.buttons.exitZenBtn.classList.toggle("hidden",!d);break;case"n":e.preventDefault(),i.modals.addCard.classList.remove("hidden"),setTimeout(()=>i.forms.newCard.querySelector("input").focus(),100);break;case"c":i.modals.customize.classList.toggle("hidden");break;case"f":"function"==typeof ev&&ev();break;case"?":case"/":e4&&e4.classList.remove("hidden")}});let e9=()=>{if(!window.driver?.js?.driver){console.warn("Driver.js not loaded");return}let e=document.getElementById("info-modal");e&&e.classList.add("hidden");let t=document.getElementById("customize-modal");t&&t.classList.add("hidden"),setTimeout(()=>{let e=window.driver.js.driver,t=s.settings.ricedModeEnabled,o=t?".top-bar":".default-header",a=[{element:t?"#main-title-riced":"#main-title",popover:{title:"Welcome to StudyLocus",description:"Your personal JEE/NEET command center. Drag cards to reorder them.",side:"bottom",align:"start"}},{element:"#dashboard-grid",popover:{title:"Your Workspace",description:"This is where your study tools live.",side:"top"}},{element:`${o} .add-card-btn`,popover:{title:"Add Widgets",description:"Click here to add To-Do lists, Timers, Graphs, or YouTube videos.",side:"bottom"}},{element:`${o} .customize-btn`,popover:{title:"Customise",description:"Change themes, fonts, wallpapers, and set your Exam Goal here. (IMPORTANT)",side:"bottom"}},{element:`${o} .zen-mode-btn`,popover:{title:"Zen Mode",description:"Hide everything except your dashboard for deep focus.",side:"bottom"}},{element:".fab-container",popover:{title:"Quick Tools",description:"Fast access to Syllabus Tracker and Zenith.",side:"left"}},{element:t?"#auth-container-riced":"#auth-container",popover:{title:"Cloud Sync & Backup",description:"Sign in with Google to save your dashboard, tasks, and settings to the cloud. Never lose your progress and access your study space from any device! NOT COMPULSORY :)",side:"left",align:"center"}},{element:t?"#main-title-riced":"#main-title",popover:{title:"Well, good luck with your preparation!",description:"If you like the project, share it with others and follow me on github pls \uD83D\uDE42",side:"bottom",align:"center"}},],r=a.filter(e=>{let t=document.querySelector(e.element);return t&&(t.offsetWidth>0||t.offsetHeight>0)}),n=e({showProgress:!0,animate:!0,allowClose:!0,overlayClickNext:!1,popoverClass:"driverjs-theme",steps:r,onDestroyStarted(){localStorage.setItem("tutorialSeen_v2","true"),n.destroy()}});n.drive()},300)};window.startTutorial=e9});